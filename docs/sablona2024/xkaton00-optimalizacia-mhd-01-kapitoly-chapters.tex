

\chapter{Úvod}
\label{uvod}

Mestskú hromadnú opravu využíva takmer každý človek a preto sa oplatí pracovať na jej efektivite.
Zmyslom tejto práce je nazrieť do problematiky vytvárania a správy jednotlivých liniek mestksej hromadnej dopravy, ich analýze a optimalizácie.
Ďalej vytvoriť nástroj, ktorý pomôže analytikom pri vytváraní nových liniek alebo optimalizácii existujúcich.
Tento nástroj popísať a otestovať na reálnych dátach.
Výsledkom celej práce by teda malo byť teoretické zefektívnenie mestskej hromadnej dopravy.

Ľudia odnepamäti nachádzjú inspiráciu pre svoje vynálezy v prírode a tomuto trendu neunikla ani informatika, ktorá má od prírody zo všetkých oborov asi najďalej.
Algoritmy inšpirované prírodov prinášaju riešenia na problémy, ktoré by sme inými spôsobmi vedeli vyriešiť len za nereálne dlhý čas.
Táto časť informaiky ma veľmi zaujala a preto som sa rozhodol nájsť ďalšie využitie pre jeden z týchto algoritmov.
Tieto algoritmy sa používajú pre komplexné problémy s veľkým množstvom navzájom sa ovplyvňujúcich premenných.
Jedným z takýchto problémov možu byť optimalizácie rôznych systémov.

Mestská hromadná doprava je systém, ktorý je pre mnoho ľudí veľmi dôležitý, preto sa oplatí investovať čas a námahu do jeho optimalizácie.
Keďže aj mne je problém s dlhým čakaním na zastávke alebo preplneným autobusm blízky, rozhodol som sa venovať sa práve jemu.

Cieľom tejto práce je vytvoriť nástroj, ktorý za pomoci genetického algoritmu a používateľských obmedzení nájde čo najoptimálnejší časový rozpis jednej linky mestskej hromadnej dopravy.
Zároveň sa tento nástroj bude dať použiť na analýzu už existujúcich rozpisov a ich porovnanie s novými riešeniami.
Nástroj bude mať uživateľské rozhranie pre rýchlu manipuláciu so vstupnými dátami a prehľadné zobrazenie výsledkov.

Práca je rozdelená na 8 kapitol vrátane úvodu a záveru, z toho najdoležitejšie sú kapitoly \ref{relevantne_vlastnosti} až \ref{uzivatelske_rozhranie}.

Po tomto úvode následuje kapitola \ref{teoreticka_cast}, v ktorej sú vysvetlené základné pojmy potrebné na porozumenie celej práce.
Optimalizácia jednotlivých rozpisov pracuje so simulačným modelom, preto je potrebné poznať základy simulácií.
V zhľadom sa systém mestksej hromadnej dopravy, konkrétne príchody vozidiel na zastávky bola zvolená diskrétna simulácia riadená udalosťami.
Ďalej je v tejto kapitole vysvetlený genetický algoritmus, jeden z algoritmov inšpirovaných prírodov, ktorý bol zvolený na riešenie problému optimalizácie.

Na zostrojenie simulačného modelu treba najprv vyhodnotiť, ktoré vlastnosti reálneho systému sú pre nás relevantné.
V kapitole \ref{relevantne_vlastnosti} je popísaná konzultácia s analytikom Dopravného podniku mesta Brno, ktorý poskytol informácie z reálneho života.
Popísal postupy a metódy, ktoré sa používajú pre optimalizáciu liniek teraz a vytýčil vlastnosti na ktoré je potrebné sa zamerať. 

Zo získaných informácií bol vytvorený simulačný model, ktorého popis, stručné zhrnutie implementácie a jednotlivé experimenty s ním sú popísané v kapitole \ref{simulacny_model}.
Výstupy simulačného modelu sú základom pre optimalizáciu časového rozpisu linky.
Ide o sériu grafov, na ktorých môže používateľ vidieť vyťaženosť linky v priebehu dňa a naprieč zastávkami.
Tieto informácie poslúžili k validácii simulačného modelu a na ohodnotenie jednotlivých rozpisov.

V kapitole \ref{optimalizacia} je popísaný proces optimalizácie časového rozpisu linky mestskej hromadnej dopravy.
Jednotlivé rozpisy ohodnotené na základe informácií získaných zo simulácie sa použijú ako jedinci v genetickom algoritme.
Genetický aloritmus bude tieto rozpisy spájať a mutovať, aby našiel čo najlepšie riešenie.
Výsledky optimalizácie budú porovnané s pôvodnými rozpismi a ohodnotené.

Samotný program by v praxi nebol moc použiteľný bez používateľského rozhrania.
V kapitole \ref{uzivatelske_rozhranie} je popísaný návrh a implementácia uživateľského rozhrania analytického nástroja.
Tento nástroj umožňuje používateľovi jednoducho zadať vstupné dáta, spustiť optimalizáciu a zobraziť výsledky.
Jednou z najdôležitejších častí tohto rozhrania je zadávanie používateľských obmedzení, ktoré musí výsledny časový rozpis splňovať.

Predposlednou kapitolou je kapitola \ref{experimenty}, ktorá sa zaoberá testovaním optimalizácie a simulačného modelu.
Na konci tejto kapitoly sa nachádza spätná väzba od analytika, ktorý poskytol informácie o reálnom systéme, a to z pohľadu možného budúceho používateľa tohto nástroja.

V závere práce \ref{zaver} je uvedené zhrnutie výsledkov a možné budúce rozšírenia a vylepšenia nástroja.

\chapter{Relevantné vlastnosti mestskej hromadnej dopravy} % 1-2 strany
\label{relevantne_vlastnosti}

Optimalizácia mestskej hromadnej dopravy je veľmi široký pojem a tento úkon sa dá previesť v mnoho rôznych smeroch.
Preto je dôležité vybrať si tú časť systému, na ktorej sa oplatí pracovať.
Pre toto rozhodnutie sú potrebné informácie o reálnom systéme, doterajších postupoch, spôsoboch analýzy a optimalizácie.

\section{Konzultácia s analytikom Dopravného podniku}
Pre získanie potrebných informácií som sa obrátil na pána Michaela Kříže, analytika Dopravného podniku mesta Brno.
Stretnutie s pánom Křížom prebehlo 7. 10. 2024 v priestoroch dopravného podniku.
Vďaka získaným informáciam som sa rozhodol zamerať na analýzu a optimalizáciu časového rozpisu jednej linky mestskej hromadnej dopravy.
Optimalizovať viac ako jednu linku naraz by pravdepodobne prinieslo lepšie výsledky, ale to len teoreticky.
V praxi by sa to z finančných a časových dôvodov neoplatilo.
Zhodli sme sa na tom, že najlepšie bude optimalizovať jednu linku a to iba jedným smerom, pretože druhý smer linky sa dá považovať za samostatnú linku, minimálne v rámci nárokov cestujúcich.

\section{Získané informácie}

Informácie, ktoré sú dôležité pre analýzu a optimalizáciu časového rozpisu linky mestskej hromadnej dopravy sú:

\begin{itemize}
  \item \textbf{Počet zastávok} --- potrebné pre zostavenie samotného rozpisu aj simulačného modelu, nie je dôležitý len počet, ale aj informácie o jednotlivých zastávkach.
  \item \textbf{Čas potrebný na prejdenie od jednej zastávky k druhej} --- tiež je to súčasťou rozpisu, zároveň sa touto informáciou riadi plánovanie udalostí v simulačnom modeli, viac v kapitole \ref{simulacny_model}.
  \item \textbf{Počet odchodov vozidla z jeho prvej zastávky za celý deň} --- týmto sa myslí celkový počet vozidiel, respektíve ciest ktoré vozidlá danej linky za deň absolvujú, tento parameter je dôležitý pre optimalizáciu, pre dopravný podnik je výhodné mať čo najmenší počet vozidiel, ktoré sú v prevádzke, šetrí to palivo, údržbu aj ľudské zdroje.
  \item \textbf{Počet odchodov vozidla z jeho prvej zastávky za hodinu} --- myslí sa tým jeden riadok v časovom rozpise, mal by byť priamo úmerný priemernému počtu cestujúcich čakajúcich na danú linku v danej hodine.
  \item \textbf{Počet cestujúcich čakajúcich na jednotlivých zastávkach} --- najdôležitejší parameter pre optimalizáciu, časový rozpis musí dostatočne uspokojiť potreby všetkých cestujúcich, zároveň je ťažké získať presné hodnoty. Pri reálnom použití by sa mala spraviť štúdia ktorá by tieto hodnoty získala. Na návrh pána Kříže som na testovacie účely použil hodnoty, ktoré sú úmerné počtu odchádzajúcich vozidiel v hodine a kapacite vozidiel, povedal, že linky v Brne sú už celkom dobre naplánované a preto by mali byť tieto hodnoty približne správne. Jedná sa o nemenný vstup optimalizácie, ktorému sa má časový rozpis prispôsobiť, preto je teoreticky jedno aké hodnoty budú do systému zadané.
  \item \textbf{Doba čakania na zastávke} --- druhý z parametrov podstatných pre optimalizáciu, systém by mal zostrojiť taký rozpis, kedy je celková doba čakania všetkych cestujúcich čo najmenšia.
  \item \textbf{Počet cestujúcich vo vozidie} --- tretí dôležitý parameter pre optimalizáciu, vysoká preplnenosť vozidla má za dôsledok nekomfortné cestovanie, na druhej strane, príliš prázdne vozidlo je neefektívne využité zo strany dopravného podniku.
  \item \textbf{Kapacita vozidla} --- každé vozidlo prenesie naraz len isté množstvo cestujúcich, zároveň sa od preplnenosti vozidla odvíja komfort cestujúcich.
  \item \textbf{Počet cestujúcich, ktorí nenásúpia kvôli preplnenosti vozidla} --- v extrémnych prípadoch može nastať, že bude vozidlo úplne plné a zvyšní cestujúci musia na zastávke čakať do príchodu ďalšieho vozidla, rozpisy pri ktorých sa toto bude diať budú veľmi negatívne ohodnocované aby sa táto zlá vlastnosť čo najviac eliminova, viac v kapitole o optimalizácii \ref{optimalizacia}.
  \item \textbf{Počet vystupujúcich cestujúcich na jednotlivých zastávkach} --- tento parameter je potrebný pre simuláciu, keďže do vozidla s istou kapacitou priebežne nastupuje veľa cestujúcich, musia z neho aj vystupovať, získanie presných hodnôt je ešte ťažšie ako pri predošlých parametroch, preto som sa rozhodol každej zastávke prideliť koeficient dôležitosti, ktorý bude určovať aký podiel cestujúcich vystúpi na danej zastávke. Na prvej zastávke je tento koeficient 0, keďze na nej cestujúci iba nastupojú, na poslednej zastávke je koeficient 1, keďže na nej cestujúci iba vystupujú a na zastávkach medzi nimi sa koeficient mení podľa toho aký podiel cestujúcich na danej zastávke priemerne vystupuje, prestupné zastávky budú mať vyšší koeficient ako tie, ktoré cestujúcich len zbierajú.
\end{itemize}

Po vytvorení simulačného modelu a implementacii optimalizácie som za pánom Krížom prišiel druhýkrát, ukázať mu výsledky, získať spätnú väzbu a zistiť jeho požiadavky na používateľské rozhranie tohto nástroja.

\textbf{\textcolor{red}{TODO navštíviť ho ešte raz a ukázať mu návrh uživateľského rozhrania.}}

\chapter{Simulačný model linky mestskej hormadnej dopravy} % 10 strán
\label{simulacny_model}

Druhým hlavným krokom po získaní potrebných informácií je zostrojenie simulačného modelu.
Problém optimalizácie časového rozpisu linky mestskej hromadnej dopravy je veľmi komplexný a vytvoriť program ktorý by ho riešil analyticky by bolo veľmi náročné.
Na modelovanie bol použitý formalizmus DEVS (Descrete Event Symulation System), po slovensky diskrétna simulácia riadená udalosťami.
Ide o typ simulácie, kde sa modelový čas posúva skokovo a to od jednej udalosti k druhej.
Viac o tomto formalizme je napísané v kapitole \ref{teoreticka_cast}.

\section{Popis simulačného modelu}
Na začiatok je potrebné definovať základné prvky modelu (viď obrázok \ref{fig:simulacny_model}), ich stavy a vzťahy medzi nimi.
Simulačný model je zložený z troch hlavných častí, tými sú:
\begin{itemize}
  \item \textbf{Kalendár udalostí} --- dôležitý pre plánovanie udalostí v modeli

  \item \textbf{Model zastávky} --- dôležitý pre príchod a odchod cestujúcich
  \item \textbf{Model vozidla} --- dôležitý pre prepravu cestujúcich medzi zastávkami
\end{itemize}

\begin{figure}[h]
  \label{fig:simulacny_model}
  \centering
  \includegraphics[width=0.9\textwidth]{DEVS-sk.drawio.pdf}
  \caption{Schéma simulačného modelu}
\end{figure}

V simulácii sa budú nachádzať viaceré inštancie modelu zastávky, každá reprezentujúc jednu zastávku na linke.
Vozidiel bude taktiež viacero, neberieme do úvahy fizcké vozidlá a fakt, že v reálnom živote sa tieto vozidlá na linke v priebehú dňa niekoľkokrát otočia.
Dôležitá je trasa, ktorú prejdu, preto jedna inštancia modelu vozidla reprezentuje jednu cestu, ktorú vozidlo prejde.
Cestujúcich v modeli nie je potrebné reprezentovať ako samostatný model, sú reprezentovaní len jedným číslom, časom kedy prišli na zastávku.
Sú súčasťou modelu zastávky, konkrétne tej na ktorej čakajú.

\subsection*{Kalendár udalostí}

Kalendár udalostí je základným prvkom modelu, ktorý riadi priebeh simulácie.
V kalendári sú uložené všetky udalosti, ktoré sa majú v modeli stať.
Tieto udalosti sú v prípade tohto modelu príchody vozidiel na zastáky.
V rámci jednej udalosti sa vykoná rutina obslúženia cestujúcich čakajúcich na zastávke.
Všetky udalosti sú naplánované na začiatku simulácie, pretože vďaka časovému rozpisu presne vieme všetky príchody vozidiel na jednotlivé zastávky.
Príchody na prvú zastávku sú dané hlavným časovým rozpisom, príchody na ostatné zastávky sú odvodené od času potrebného na prejdenie z jednej zastávky na druhú.
Pseudokód plánovania udalostí je uvedený v algoritme \ref{algoritmus_planovanie_udalosti}.
V priebehu simulácie už netreba žiadne ďalšie udalosti plánovať.

\vspace*{\dimexpr 0.5\baselineskip\relax}
\begin{algorithm}[H]
  \label{algoritmus_planovanie_udalosti}
  \caption{Plánovanie udalostí}
    \For{čas v časovom rozpise počiatočnej zastávky} {
      Vytvorí sa vozidlo\;
      \For{zastávka na linke} {
        Pridá sa udalosť príchodu vozidla na danú zastávku\;
      }
    }
\end{algorithm}
\vspace*{\dimexpr 0.5\baselineskip\relax}

Po naplánovaní všetkých udalostí sa začne simulácia.
Postupne sa vykonávajú jednotlivé udalosti a simulácia sa diskrétne posúva vpred, až kým nie je kalendár udalostí prázdny alebo nie je dosiahnutý koncový čas simulácie.
Pseudokód riadenia simulácie je popísaný v algoritme \ref{algoritmus_riadenia_simulacie}.

\vspace*{\dimexpr 0.5\baselineskip\relax}
\begin{algorithm}[H]
\label{algoritmus_riadenia_simulacie}
\caption{Simulácia riadená udalosťami}
  \While{kalendár udalostí nie je prázdny} {
    Vyberie sa udalosť s najmenším časom v kalendári\;
    Udalosť sa odstráni z kalendára\;
    \If{čas udalosti > koncový čas simulácie} {
      Simulácia končí\;
    }
    Modelový čas sa nastaví na čas udalosti\;
    Udalosť sa vykoná\;
  }
\end{algorithm}
\vspace*{\dimexpr 0.5\baselineskip\relax}

Pre potreby časového rozpisu stačí simulovať jeden deň, v prípade rôznych rozpisov v čase pracovnýh dní a v čase sviatkov a víkendov ide o kompletne iný rozpis, ktorý sa musí simulovať a optimalizovať samostatne.
Všetky naplánované udalsti by mali byť v rámci jedného dňa, preto by simulácia mala končiť vždy vyprázdnením kalendára udalostí a nie prekročením koncového času.

\subsection*{Model zastávky}
\label{model_zastavky}

Model zastávky slúži na reprezentáciu jednotlivých zastávok na linke.
Každá reálna zastávka je v systéme ako samostatná inštancia modelu zastávky.
Je pasívna, to znamená, že jej vnútorný stav sa plne odvíja od prichádzajúcich vonkajších signálov.

\begin{figure}[h]
  \label{fig:model_zastavky}
  \centering
  \includegraphics[width=0.6\textwidth]{DEVS-zastavka-sk.drawio.pdf}
  \caption{Stavový automat modelu zastávky}
\end{figure}

Ako je vidieť na obrázku \ref{fig:model_zastavky}, model zastávky má tri stavy:
\begin{itemize}
  \item \textbf{Cestujúci čakajú} --- na zastávke nie je žiadne vozidlo
  \item \textbf{Vozidlo na zastávke} --- na zastávku práve prišlo vozidlo
  \item \textbf{Cestujúci nastupojú} --- cestujúci nastupujú do vozidla
\end{itemize}

Dôleťitejšie sú však vstupné signály, ktorími je celý stavový automat riadený.
Zároveň sa pri prechodoch medzi stavmi vykonávajú akcie pre obsluhu cestujúcich.

Vstpný signál \textbf{?Vozidlo\_prišlo} mení vnútorný stav zastávky z \textbf{Cestujúci čakajú} na \textbf{Vozidlo na zastávke}.
Taktiež s vypočíta dĺžka intervalo medzi posledným príchodom vozidla a terajším príchodom.
Tento údaj slúži pre vygenerovanie prichádzajúcich cestujúcich.

Vstupný signál \textbf{?Začiatok\_nastupovania} mení vnútorný stav zastávky z \textbf{Vozidlo na zastávke} na \textbf{Cestujúci nastupujú}.
Pri tomto prechode sa vygenerujú časi všetkých cestujúcich, ktorí prišli od posledného príchodu vozidla.

Vstupný signál \textbf{?Koniec\_nastupovania} mení vnútorný stav zastávky z \textbf{Cestujúci nastupujú} na \textbf{Cestujúci čakajú}.
Prepíše sa čas posledného príchodu vozidla.

\subsubsection{Generovanie cestujúcich}

Cestujúci sa generujú na základne exponenciálneho rozdelenia s parametrom $\lambda$.
Tento parameter je v rámci jednej zastávky každú hodinu iný, pretože počet prichádzajúcich cestujúcich sa v priebehu dňa mení.
V algoritme \ref{algoritmus_generovanie_cestujucich} je popísaný proces generovania cestujúcich na zastávke.

\vspace*{\dimexpr 0.5\baselineskip\relax}
\begin{algorithm}[H]
\label{algoritmus_generovanie_cestujucich}
\caption{Generovanie cestujúcich}
  získanie $\lambda$ pre danú zastáku a hodinu\;
  \While{modelový čas < čas príchodu autobusu} {
    vygenerovanie času príchodu cestujúceho\;
    pridanie cestujúceho do fronty\;
    zmena modelového času na čas príchodu cestujúceho\;
  }
\end{algorithm}

\subsection*{Model vozidla}
\label{model_vozidla}

Každé vozidlo, respektíve jedna trasa ktorú vozidlo podľa časového rozpisu prejde, je reprezentovaná jednou inštanciou modelu vozidla.
Model vozidla je na rozdiel od modelu zastávky aktívnym prvkom, nemá žiadne vstupné signály, iba výstupné.
Tieto výstupné signály sú prepojené so vstupnými signálmi modelu zastávky ako je vidieť na obrázku \ref{fig:simulacny_model}.

\begin{figure}[h]
  \label{fig:model_vozidla}
  \centering
  \includegraphics[width=0.6\textwidth]{DEVS-vozidlo-sk.drawio.pdf}
  \caption{Stavový automat modelu vozidla}
\end{figure}

Na obrázku \ref{fig:model_vozidla} je vidieť stavový automat modelu vozidla.
Model vozidla má tri stavy:
\begin{itemize}
  \item \textbf{Na ceste} --- vozidlo sa pohybuje medzi zastávkami
  \item \textbf{Na zastávke} --- vozidlo práve prišlo na zastávku
  \item \textbf{Nakladá cestujúcich} --- vozidlo nakladá cestujúcich
\end{itemize}

Výsupný signál \textbf{!Príchod} mení vnútorný stav vozidla z \textbf{Na ceste} na \textbf{Na zastávke}.
Pri tomto prechode vystúpia cestujúci podľa koeficientu zastávky na ktorú vozidlo práve prišlo.
Napríklad ak je vo vozidle 100 cestujúcich a koeficient zastávky je 0.7, pretože sa jedná o prestupnú zastávku, vystúpi 70 cestujúcich.

Výstupný signál \textbf{!Nastupovanie} mení vnútorný stav vozidla z \textbf{Na zastávke} na \textbf{Nakladá cestujúcich}.
Zastávka, na ktorej sa vozidlo práve nachádza tento signál zachytí a vygeneruje nových cestujúcich.
Pokiaľ to dovoluje kapacita vozidla, všetci cestujúci nastúpia.
V opačnom prípade nastúpia len tí, ktorí prišli skôr a tí čo prišli neskôr musia ostať čakať na ďalšie vozidlo.

Výstupný signál \textbf{!Odchod} mení vnútorný stav vozidla z \textbf{Nakladá cestujúcich} na \textbf{Na ceste}.
Informuje sa príslušná zastávka a nič viac sa pri tomto prechode nevykonáva.

\subsubsection{Obsluha zastávky}

Každé vozidlo začina na prvej zastávke v rozpise, ale počas simulácie sa musí pohybovať medzi zastávkami.
Proces ktorý vozidlo vykoná pri príchode na každú zastávku je popísaný v algoritme \ref{algoritmus_obsluha_zastavky}.

\vspace*{\dimexpr 0.5\baselineskip\relax}
\begin{algorithm}[H]
\label{algoritmus_obsluha_zastavky}
\caption{Obsluha zastávky}
  prepojenie výstupných signálov vozidla so vstupnými signálmi zastávky\;
  aktivácia výstupného signálu \textbf{!Príchod}\;
  aktivácia výstupného signálu \textbf{!Nastupovanie}\;
  aktivácia výstupného signálu \textbf{!Odchod}\;
\end{algorithm}

\subsection*{Udalosť príchodu vozidla na zastávku}

V rámci jednej udalosti sa vykoná rutina obslúženia cestujúcich, ktorí čakajú na zastávke. Táto rutina je popísaná v algoritme \ref{algoritmus_obsluha_zastavky}.
Parametre tejto udalosti sú:
\begin{itemize}
  \item \textbf{Čas príchodu} --- čas, kedy vozidlo prichádza na zastávku
  \item \textbf{Zastávka} --- zastávka, na ktorej sa udalosť vykonáva
  \item \textbf{Vozidlo} --- vozidlo, ktoré prichádza na zastávku
\end{itemize}

Vozidlo začína udalosť v stave \textbf{Na ceste}, príde na zastávku uvedenú v parametri udalosti, vykoná rutinu nástupu a výstupu cestujúcich a odíte na ďalšiu zastávku.
Za jednu udalosť teda vozidlo prejde všetkými svojimi vnútorným stavmi, udalosť končí v opaäť v stave \textbf{Na ceste}.
Zastávka ktorá je uvedená v parametri udalosti tiež prejde všetkými svojimi vnútornými stavmi na základe posielaných signálov od vozidla.

\section{Implementácia simulačného modelu}

Simulačný model je implementovaný v jazyku Python bez využitia externých knižníc.
Trieda \texttt{EventCalendar} obsahuje kód základných operácií nad kalendárom udalostí:
\begin{itemize}
  \item \texttt{isEmpty()} --- vráti \texttt{True} ak je kalendár udalostí prázdny, inak \texttt{False}
  \item \texttt{addEvent(event)} --- pridá udalosť do kalendára
  \item \texttt{getNextEvent()} --- vráti udalosť s najmenším časom v kalendári a odstráni ju z kalendára
\end{itemize}

Trieda \texttt{Event} reprezentuje jednu udalosť.
Obsahuje:
\begin{itemize}
  \item metóda \texttt{\_\_call\_\_()} --- vykoná akciu
  \item atribúty \texttt{action} a \texttt{actionArgument}
\end{itemize}

len metódu \texttt{\_\_call\_\_()}, ktorá vykoná udalosť uloženú v atribúte \texttt{action} s argumentami volania uloženými v \texttt{actionArgument}.

Modelový čas je implementovaný v triede \texttt{Simulation}.
Obsahuje:
\begin{itemize}
  \item metódy \texttt{forward(time)} a \texttt{getHour()}
  \item atribúty \texttt{startTime}, \texttt{currentTime} a \texttt{endTime}
\end{itemize}

Trieda \texttt{BusStop} reprezentuje jednu zastávku, rovnako tak trieda \texttt{Bus} reprezentuje jedno vozidlo.
Tieto dve triedy sú písané podľa vzoru DEVS formalizmu. Obsahujú stavy, vstupné a výstupné signály a metódy, v ktorých sa nachádzjú akcie pre jednotlivé prechody medzi stavmi.
Cestujúci sú uložení ako pole čisel, časov ich príchodu, v jednotlivých zastávkach v atribúte \texttt{waitingPassengersArrivalTimes}.

Na generovanie náhodného príchodu cestujúcich slúži trieda \texttt{RandomNumberGenerator}, ktorá obsahuje statické metódy na generovanie náhodných čísel.

Zber a agregácia štatistík (viď kapitola \ref{vystupy_simulacneho_modelu}) sú implementované v triedach \texttt{Statistics}, \texttt{BusStatistics} a \texttt{BusStopStatistics}.

Podrobnejšie informácie o kóde sa nachádzajú v programovej dokumentácii, v prílohe~\ref{prilohy_programova_dokumentacia}.
Programová dokumentácia bola vygenerovaná pomocou nástroja Sphynx.

\section{Výstupy simulačného modelu}
\label{vystupy_simulacneho_modelu}

Hlavný zmisel simulácie je zber informácií, ktoré by sme inak museli získať z pozorovania reélnej prevádzky linky.
Efektivitu každého jedného časového rozpisu, ktorý program vytvorí je potrebné otestovať a ohodnotiť aby sme našli ten najlepší z nich, skôr ako ho začneme používať v reálnej prevádzke.
Na ohodnotenie jednotlivých rozpisov slúžia štatistiky získané počas simulácie.
Štatistiky sa zbierajú pre každú zastávku aj pre každý autobus osobitne.
Následne sa agregujú do jednoho objektu \texttt{Statistics}, ktorý obsahuje:
\begin{itemize}
  \item \texttt{totalNumberOfBuses} --- počet spojov v priebehu dňa na linke
  \item \texttt{busStopStatistics} --- agregované štatistiky zastávok
  \item \texttt{busStatistics} --- agregované štatistiky vozidiel
\end{itemize}

Trieda \texttt{busStopStatistics} slúži na ukladanie informácii o jednotlivých zastávkach, ale ako bolo spomenuté vyššie tak aj na uloženie agregovaných dát.
Táto trieda slúži na zber následujúcich informácií:
\begin{itemize}
  \item \texttt{totalPassengersArrived} --- počet cestujúcich, ktorí prišli na zastávku za celý deň
  \item \texttt{totalPassengersDeparted} --- počet cestujúcich, ktorí vystúpili na zastávke za celý deň
  \item \texttt{totalPassengersLeftUnboarded} --- počet cestujúcich, ktorí museli čakať na ďalší spoj
  \item \texttt{totalTimeSpentWaiting} --- celkový čas, ktorý cestujúci strávili čakaním na zastávke
  \item \texttt{totalPassengersLeftUnboarded} --- počet cestujúcich, ktorých po celom dni nezobral žiaden spoj
  \item \texttt{passengersArrivedPerHour} --- počet cestujúcich, ktorí prišli na zastávku v jednotlivých hodinách
  \item \texttt{passengersDepartedPerHour} --- počet cestujúcich, ktorí vystúpili na zastávke v jednotlivých hodinách
  \item \texttt{passengersLeftUnboardedPerHour} --- počet cestujúcich, ktorí museli čakať na ďalší spoj v jednotlivých hodinách
  \item \texttt{timeSpentWaitingPerHour} --- čas, ktorý cestujúci strávili čakaním na zastávke v jednotlivých hodinách
\end{itemize}

Trieda \texttt{busStatistics} má rovnaký účel ako trieda \texttt{busStopStatistics}, ale pre vozidlá.
Zbiera informácie:
\begin{itemize}
  \item \texttt{capacity} --- kapacita vozidla
  \item \texttt{averageLoad} --- priemerná naplnenosť vozidla
  \item \texttt{averageLoadInPercent} --- priemerná naplnenosť vozidla v percentách
  \item \texttt{totalPassengersTransported} --- celkový počet prevezených cestujúcich
  \item \texttt{loadPerBusStop} --- naplnenosť vozidla na jednotlivých zastávkach
  \item \texttt{loadInPercentPerBusStop} --- naplnenosť vozidla na jednotlivých zastávkach v percentách
\end{itemize}

\subsection*{Počet spojov v priebehu dňa na linke}
Tento údaj slúži pre optimalizáciu, z pohľadu dopravného podniku chceme, aby bol pocet spojov čo najmenší aby ušetrili na prevádzkových nákladoch.
Z pohľadu cestujúcich chceme aby bol počet spojov čo najväčší, aby nemuseli čakať na spoj dlhšie ako je nutné.
Je potrebné nájsť kompromis medzi týmito dvoma extrémami.

\subsection*{Počet cestujúcich, ktorí prišli na zastávku za celý deň}
Celkový počet cestujúcich za deň je dobrím indikátorom toho, ako sú namáhané jednotlivé časti linky.
V prípadoch, kedy na zastávky v strede trasy prichádza oveľa viac cestujúcich ako na koncové zastávky, posilňuje dopravný podnik práve túto strednú časť ďalšími spojmi.
Tieto spoje však na koncové zastávky už nechodia.

\subsection*{Počet cestujúcich, ktorí vystúpili na zastávke za celý deň}
Je potrebné aby sme v rámci simulácie rátali aj s cestujúcimi, ktorí z vozidiel vystupujú, inak by sa kapacita vozidla hneď naplnila.
Ide o dôležitú časť reálneho systému, ktorú nemôžeme zanedbať ani pri simulácii.
Slúži na validáciu modelu.

\subsection*{Počet cestujúcich, ktorí museli čakať na ďalší spoj}
Občas sa stane, že je vozidlo tak preplnené, že nie všetci cestujúci, ktorí čakali na zastávke do neho nastúpia.
V reálnom živote ide asi o subjektívny pocit, či nastúpiť alebo nie.
V simulačnom modeli cestujúci prestanú nastupovať v momente keď naplnenosť vozidla dosiahne jeho maximálnu kapacitu.
Rozpisy, pri ktorých sa tento jav vyskytne budú mať horšie hodnotenie.

\subsection*{Celkový čas, ktorý cestujúci strávili čakaním na zastávke}
Z pohľadu optimalizácie chceme, aby bol tento čas čo najnižší.
Príliš dlhé čakanie na zastávke bude rozpisy ohodnocovať negatívne.
V prípade, že cestujúci musel čakať na ďalší spoj, tento šas bude ešte dlhší.
Treba rátať aj s cestujúcimi, ktorí na zastávku prídu tesne pred odchodom vozidla.
Napríklad ak chodí spoj dvakrát za hodinu, je oveľa vyššia pravdepodobnosť, že cestujúci nepríde v náhodný čas, ale svoj príchod na zastávku si naplánuje.

\subsection*{Počet cestujúcich, ktorých po celom dni nezobral žiaden spoj}
Podobne ako v prípade cestujúcich, ktorí museli čakať na ďalší spoj, aj týchto cestujúcich by sme mali rátať a rozpis by mal byť ohodnotený veľmi negatívne.
Tento jav by mohol v reálnom svete nastať asi iba ak by cestujúci išiel na posledný spoj v dni a toto vozidlo by bolo úplne preplnené.
Ale keďže optimalizácia v tomto programe je riešená genetickým algoritmom, je veľká šanca že sa tento jav vyskytne častejšie.
Táto vlastnosť je nežiaduca a je potrebné ju eliminovať.

\subsection*{Počet cestujúcich, ktorí prišli na zastávku v jednotlivých hodinách}
Tento údaj má skôr informatívny charakter, pretože ide o vstup programu.
Algoritmus sa snaží vytvoriť rozpis, ktorý by bol schopný prepraviť všetkých cestujúcich.
Na grafe \ref{fig:passengersArrivedPerHour} je vidieť, že v priebehu dňa sa počet cestujúcich prichádzajúcich na zastávku mení.
Obzvlášť v ranných a poobedných hodinách je tento počet výrazne vyšší ako počas dňa.
V týchto časoch by malo chodiť viac spojov.
\begin{figure}[h]
  \label{fig:passengersArrivedPerHour}
  \centering
  \includegraphics[width=0.5\textwidth]{passengersArrivedPerHour.png}
  \caption{Počet cestujúcich, ktorí prišli na zastávku v jednotlivých hodinách}
\end{figure}

\subsection*{Počet cestujúcich, ktorí vystúpili na zastávke v jednotlivých hodinách}
Ide o rovnaký údaj ako bol počet cestujúcich, ktorí vystúpili na zastávke za celý deň, ale rozdelený na jednotlivé hodiny dňa.
Je vidieť, že graf \ref{fig:passengersDepartedPerHour} má podobný tvar ako graf \ref{fig:passengersArrivedPerHour}.
To je správne, pretože počet cestujúcich, ktorí vystúpili na zastávke by mal byť rovnaký ako počet cestujúcich, ktorí prišli na zastávku.
Mohlo by sa stať, že tieto dve hodnoty by sa líšili, v prípade, že ostatnú cestujúci, ktorí sa v priebehu dňa nezmestili do žiadneho vozidla.
\begin{figure}[h]
  \label{fig:passengersDepartedPerHour}
  \centering
  \includegraphics[width=0.5\textwidth]{passengersDepartedPerHour.png}
  \caption{Počet cestujúcich, ktorí vystúpili na zastávke v jednotlivých hodinách}
\end{figure}

\subsection*{Počet cestujúcich, ktorí museli čakať na ďalší spoj v jednotlivých hodinách}
Na ľavej strane grafu \ref{fig:passengersLeftUnboardedPerHour} je vidieť, že v priebehu ďňa žiaden z cestujúcich nemusel čakať na ďalší spoj.
Toto je ideálny stav.
Na pravej strane grafu \ref{fig:passengersLeftUnboardedPerHour} je vidieť, že v priebehu dňa sa počet cestujúcich, ktorí museli čakať na ďalší spoj mení.
Ráno a okolo obeda nemusel na ďalší spoj čakať nikto, ale v poobednej špičke je vidieť zjavný nedostatok spojov, pretože cestujúci musia čakať na ďalší spoj.
\begin{figure}[h]
  \label{fig:passengersLeftUnboardedPerHour}
  \centering
  \begin{minipage}{0.49\textwidth}
    \includegraphics[width=\textwidth]{passengersLeftUnboardedPerHour.png}
  \end{minipage}
  \begin{minipage}{0.49\textwidth}
    \includegraphics[width=\textwidth]{passengersLeftUnboardedPerHour_nonoptimal.png}
  \end{minipage}
  \caption{Počet cestujúcich, ktorí museli čakať na ďalší spoj v jednotlivých hodinách}
\end{figure}

\subsection*{Čas, ktorý cestujúci strávili čakaním na zastávke v jednotlivých hodinách}
Čas strávený čakaním na zastávke by mal byť počas celého dňa približne rovnaký.
Na ľavej strane grafu \ref{fig:timeSpentWaitingPerHour} je tento optimálny stav vidieť.
Bez ohľadu na to, kedy cestujúci prídu na zastávku, čakajú na spoj rovnako dlho.
Naopak na prave strane grafu \ref{fig:timeSpentWaitingPerHour}, ktorý je výstupom rovnakej simulácie ako pravá strana grafu \ref{fig:passengersLeftUnboardedPerHour}, je zrejmé, že čas čakania na zastávke sa v poobedných hodinách výrazne zvýšil práve kvoli tomu, že cestujúci museli čakať na ďalší spoj.
\begin{figure}[h]
  \label{fig:timeSpentWaitingPerHour}
  \centering
  \begin{minipage}{0.49\textwidth}
    \includegraphics[width=\textwidth]{timeSpentWaitingPerHour.png}
  \end{minipage}
  \begin{minipage}{0.49\textwidth}
    \includegraphics[width=\textwidth]{timeSpentWaitingPerHour_nonoptimal.png}
  \end{minipage}
  \caption{Čas, ktorý cestujúci strávili čakaním na zastávke v jednotlivých hodinách}
\end{figure}

\subsection*{Kapacita vozidla}
Tento parameter je dôležitý, pretože na základe neho sa rozhoduje, koľko cestujúcich môže nastúpiť do vozidla.
Zároveň slúži pre výpočet naplnenosti vozidla v percentách.
Príliš malá alebo príliš veľká naplnenosť vozidla môže byť nežiaduca.
Na ohodnotenie toho, ako moc je vozidlo naplnené teda treba poznať aj jeho kapacitu.

\subsection*{Priemerná naplnenosť vozidla}
Priemerná naplnenosť vozidla je dôležitý parameter, ktorý nám hovorí, ako moc sú vozidlá využívané.
Z pohľadu cestujúcich je lepšie, ak je vozidlo prázdnejšie, ale z pohľadu dopravného podniku je to nevyužitý potenciál.
Preto je potrebné nájsť kompromis medzi týmito dvoma požiadavkami.
To aká naplnenosť je optimálna je už úlohou analytika, ktorý bude tento program využívať.
Povedzme, že sa rozhodne pre naplnenosť 70\%.
Potom čim ďalej bude priemerná naplnenosť vozidiel od tejto hodnoty, tým horšie bude rozpis ohodnotený.

\subsection*{Celkový počet prevezených cestujúcich}
Celkový počet prevezených cestujúcich záleží od toho, koľko cestujúcich prišlo na jednotlivé zastávky a či sa im podarilo nastúpiť do vozidiel.
V ideálnom prípade sa tento počet bude rovnať počtu cestujúcich, ktorí prišli na zastávky.
V extrémnych prípadoch sa môže stať, že niektorí cestujúci zostanú na zastávkach a nezoberie ich žiadne vozidlo.
V prípade štatistiky jednotlivých vozidiel, môže byť tento počet použitý na ich porovnanie.
Počas dňa by mali všetky vozidlá prepraviť približne rovnaký počet cestujúcich.
Ak tomu tak nie je a sú vyťažené nerovnomerne, rozpis by sa mal ohodnotiť negatívne.

\subsection*{Naplnenosť vozidla na jednotlivých zastávkach}
Na grafe \ref{fig:averageLoad} je znázornené ako sa naplnenosť vozidiel mení počas ich jazdy.
Konkrétne sa jedná o linku 46 v Brne.
Naplnenosť sa postupne zvyšuje až kým nepríde na jednu z hlavných prestupných zastávok, Štefánikova čtvrť.
Tu vystúpi veľké množstvo cestujúcich a naplnenosť vozidla sa zníži.
Pokiaľ má linka príliš veľké výkivy v naplnenosti vozidiel naprieč svojou trasou, môže to byť znakom toho, že je potrebné trasu na určitých úsekoch posilniť inou linkou.
\begin{figure}[h]
  \label{fig:averageLoad}
  \centering
  \includegraphics[width=\textwidth]{loadInPercentPerBusStop.png}
  \caption{Priemerná naplnenosť vozidla na jednotlivých zastávkach}
\end{figure}

\chapter{Optimalizácia časového rozpisu linky mestskej hormadnej dopravy} % 15 strán
\label{optimalizacia}

Optimalizácia časového rozpisu je zložitý problém s veľkým množstvom premenných a obmedzení.
Táto kapitola pojednáva o daných vstupoch, obmedzeniach, použitej optimalizačnej metóde a výstupoch optimalizácie.

Na optimalizáciu bol použitý genetický algoritmus.
Genetický algoritmus je heuristická optimalizačná metóda, ktorá sa inšpiruje evolučnou biológiou.
Je založená na princípe prírodného výberu, kde sa najlepšie jedince z populácie vyberajú na reprodukciu a vytvárajú novú generáciu.
Tento proces sa opakuje, až kým sa nenájde optimálne riešenie alebo sa nedosiahne maximálny počet generácií.
Na ohodnotenie jedinca sa používa fitness funkcia, ktorá hodnotí kvalitu riešenia na základe zadaných kritérií.
V prípade časových rozpisov MHD sa na výpočet fitness funkcie používajú štatistiky zo simulácie, ktoré sú popísané v kapitole \ref{vystupy_simulacneho_modelu}.

\section{Vstupy potrebné od používateľa}
\label{vstupy_pouzivatela}
Na to aby mohol algoritmus fungovať, je potrebné zadať niekoľko vstupných parametrov.
Najdôležitejším z nich sú informácie o zastávkach. O každej zastávke je potrebné zadať:
\begin{itemize}
  \item \textbf{Názov zastávky} --- názov zastávky, ktorý sa zobrazuje na výstupoch
  \item \textbf{Čas príchodu} --- čas potrebný na prejdenie vzdialenosti od prvej zastávky po túto zastávku
  \item \textbf{Štatistika o príchodoch cestujúcich} --- priemerný počet prichádzajúcich cestujúcich v každej hodine dňa
  \item \textbf{Pravdepodobnosť výstupu cestujúceho} --- údaj potrebný pre priebežné vyprázdnenie vozidla
\end{itemize}
Tieto informácie sa zadávajú vo forme textového súboru, každá zastávka je na samostatnom riadoku a jednotlivé údaje sú oddelené dvojbodkou.
Príklad toho ako by mali vyzerať záznami o zastávkach:

\noindent \texttt{Lesná, Haškova:0:[(5, 60), (6, 90), \ldots , (21, 40), (22, 30)]:0 \newline
  Brechtova:1:[(5, 60), (6, 90), \ldots , (21, 40), (22, 30)]:0.1 \newline
  Blažkova:2:[(5, 60), (6, 90), \ldots , (21, 40), (22, 30)]:0.1 \newline
  \ldots
}

Ďalšie dôležité informácie o linke sú:
\begin{itemize}
  \item \textbf{Kapacita vozidla} --- maximálny počet cestujúcich, ktorý sa zmestí do vozidla
  \item \textbf{Miest na sedenie} --- počet miest na sedenie v vozidle
  \item \textbf{Celkové náklady} --- udávané v Kč/100 miesto-km (tabuľková hodnota) 
  \item \textbf{Dĺžka trasy} --- dĺžka trasy v km
\end{itemize}
Kapacita vozidla a počet miest na sedenie sú potrebné pre výpočet naplnenosti vozidla, od ktorého sa potom odvíja spokojnosť cestujúcich.
Celkové náklady na 100 miestokilometrov a dĺžka trasy sú potrebné pre výpočet nákladov na prevádzku linky.
Podrobnejší popis výpočtu celkovej spokojnosti a nákladov na prevádzku je v kapitole \ref{implementacia_genetickeho_algoritmu}.

Potom je potrebné zadať parametre genetického algoritmu, ktoré sú:
\begin{itemize}
  \item \textbf{Veľkosť populácie} --- počet jedincov v jednej generácii
  \item \textbf{Počet generácií} --- počet generácií, ktoré sa majú vykonať
  \item \textbf{Pravdepodobnosť mutácie} --- pravdepodobnosť, že sa v jedincovi vyskytne mutácia
  \item \textbf{Maximálny počet spojov za hodinu} --- maximálny počet spojov, ktorý môže byť vygenerovaný za hodinu
\end{itemize}
Poslednou informáciou, ktorá je od používateľa potrebná sú obmedzenia na počet spojov za hodinu.
Používateľ takto môže nastaviť fixný počet spojov, ktorý sa má vygenerovať za hodinu.
Toto sa využíva hľavne pri plánovaní náväznosti liniek, kedy je potrebné aby sa niektoré spoje stretli na prestupnej zastávke.
Obvykle sa to robí tak, že sa nastaví rovnaký počet spojov pre všetky prestupné linky, ktoré sa na tejto zastávke stretávajú.
Toto obmedzenie využíva aj predbežná analýza, ktorá sa vykonáva pred optimalizáciou.
V prípade ak pre niektorú hodinu neexistuje údaj o priemernom počte prichádzajúcich cestujúcich naprieč všetkými zastávkami, nastaví sa fixný počet spojov v danej hodine na 0.
Tento krok výrazne prispieva k lepším výsledkom optimalizácie, pretože dopredu vieme, že v tejto hodine nebude žiaden spoj potrebný.
Zároveň s nižším počtom spojov vo všetkých rozpisoch počas optimalizácie sa výpočet výrazne urýchli.

\section{Základná implementácia genetického algoritmu}
\label{implementacia_genetickeho_algoritmu}
Na optimalizáciu časového rozpisu bol použitý genetický algoritmus.
Genetický algoritmus je heuristická optimalizačná metóda, ktorá sa inšpiruje Darwinovou teóriou evolúcie.
Podľa citátu od Charlesa Darwina, "V prírode je prežitie a úspech otázkou tých najschopnejších a najpríťažlivejších",
aj genetický algoritmus sa snaží nájsť najlepšie riešenie problému pomocou evolučného procesu.
Používajú sa postupy ako je náhodná mutácia jedinca a rozne typy výberu a kríženia jedincov.
Myšlienka je, že najlepší jedinci v generácii buď splňujú požiadavky alebo sú veľmi blízko k optimálnemu riešeniu.
Predpokladá sa, že týto jedinci majú najlepšie predispozície na to, aby ich potomkovia boli o krok bližšie k optimálnemu riešeniu.
Využitie genetického algoritmu je efektívne v prípadoch, kedy by deterministické metódy trvali príliš dlho alebo by vôbec neboli schopné nájsť optimálne riešenie.
Genetický algoritmus bol prvýkrát predstavený okolo roku 1960 Johnom Hollandom na Univerzite v Michigane (viď \cite{9002372}).

\vspace*{\dimexpr 0.5\baselineskip\relax}
\begin{algorithm}[H]
\label{algoritmus_geneticky_algoritmus}
\caption{Genetický algoritmus}
  Inicializácia prvej populácie\;
  Definovanie fitness funkcie\;
  Výpočet fitness funkcie pre každého jedinca v populácii\;
  \While{nie je nájdené optimálne riešenie alebo nebol dosiahnutý maximálny počet generácií} {
    Výber rodičov z populácie\;
    Kríženie rodičov na vytvorenie potomkov\;
    Mutácia potomkov\;
    Výpočet fitness funkcie pre každého potomka\;
  }
  Výber najlepšieho jedinca z populácie\;
\end{algorithm}

V prípade optimalizácie časového rozpisu MHD sa jedincami stávajú samotné časové rozpisy.
Na základe simulácie jedného dňa na linke s použitým časovým rozpisom sa získajú štatistiky, ktoré sa následne použijú na ohodnotenie kvality jedinca.

\subsection*{Výpočet cieľov, spokojnosť cestujúcich a náklady na prevádzku}
Pre ohodnotenie kvality časového rozpisu sa zvolili dva hlavné ciele:
\begin{itemize}
  \item \textbf{Spokojnosť cestujúcich} --- priemerné percentuálne zhodnotenie spokojnosti všetkých cestujúcich, ktorí prišli za deň na zastávku
  \item \textbf{Náklady na prevádzku} --- celkové náklady na prevádzku linky za deň, udávané v Kč/100 miesto-km
\end{itemize}

Výpočet spokojnosti cestujúceho sa vykonáva v čase nástupu do vozidla. Zhodnocuje sa aktuálna naplnenosť vozidla a na základe toho sa vypočíta percentuálne zhodnotenie spokojnosti.
Potrebné parametre pre výpočet sú kapacita vozidla, počet miest na sedenie a aktuálna naplnenosť vozidla.
Výpočet sa riadi následujúcimi troma podmienkami:
\begin{enumerate}
  \item Ak sú vo vozidle voľné miesta na sedenie, cestujúci si sadne a jeho spokojnosť je 1
  \item Ak je vozidlo úplne plné a cestujúci sa do neho nezmestí, jeho spokojnosť je 0
  \item Ak je vo vozidle miesto, ale už len na státie, spokojnosť vozidla závisí od aktuálnej naplnenosti vozidla a je vypočítaná ako: \begin{equation}
      \text{spokojnosť} = 1 - \frac{\text{aktualna naplnenosť vozidla} - \text{počet miest na sedenie}}{\text{kapacita vozidla}  - \text{počet miest na sedenie}}
    \end{equation}
\end{enumerate}
Nakonci sa vypočíta priemer spokojnosti všetkých cestujúcich.
Hodnota sa pohybuje od 0 do 1 a genetický algoritmus uprednostňuje vyššie hodnoty, teda spokojnejších cestujúcich.

Celkové náklady na prevádzku linky sú vypočítané z počtu spojov v časovom rozpise, kapacity použitých vozidiel, dĺžky trasy a nákladov na jeden miestokilometer.
Jeden miestokilometer je definovaný ako vzdialenosť jedného kilometra, ktorú prejde jedno miesto vo vozidle.
Potom vozidlo s kapacitu 80 miest, ktoré prejde 10 km, prejde 800 miestokilometrov.
Miestokilometre sa môžu násobiť aj počtom vozidiel, potom dve takéto vozidlá by prešli 1600 miestokilometrov.
Informácie o tejto jednotke sú prevzaté od pána Michala Hlaváčka, zamestnanca Dopravného podniku mesta Brno, pomoocu mailovej komunikácie, ktorá je dostupná v prílohe \ref{prilohy_mail_hlavacek}.
Tento údaj je potrebný pretože náklady vo finančnom pláne Dopravného podniku mesta Brno sú udávané v českých korunách na 100 miestokilometrov.
Finančný plán na rok 2025 je v prílohe \ref{prilohy_financny_model}.
Celý výpočet nákladov na prevádzku linky teda závisí od štyroch premenných a je daný vzorcom:
\begin{equation}
  \text{ceľkové náklady} = \frac{\text{dĺžka trasy} \cdot \text{počet spojov} \cdot \text{kapacita vozidla}}{100} \cdot \text{náklady}
\end{equation}

Tieto dva ciele sú v konflikte, pretože čím viac spojov je na linke, tým je spokojnosť cestujúcich vyššia, ale náklady na prevádzku sú tiež vyššie.
Tento problém rieši multi-objektívna optimalizácia, ktorá sa snaží nájsť optimálne riešenie pre oba ciele naraz.

\subsection*{Genetický algoritmus s viacero cieľmi}
Genetický algoritmus, v ktorom sa snažíme dosiahnuť optimálneho kompromisu medzi viacero cieľmi sa nazýva multi-objektívny genetický algoritmus.
Jeho myšlienka spočíva v nájdení Pareto frontu, čo je množina všetkých možných riešení, ktoré sú optimálne z pohľadu všetkých cieľov.
To znamená, že neexistuje žiaden iný jedinec, ktorý by bol lepší v oboch cieľoch naraz.
Ak je jeden jedinec lepší v oboch cieľoch, hovoríme, že dominuje iného jedinca.
V prípade, že dominuje iba v jendom, ale v druhom nie, patria do rovnakej skupiny, sú si rovnocenní.
Ak je jedinec horší v oboch cieľoch, hovoríme, že je dominovaný.
Každá generácia sa rozdelí do rovnocenných skupín, pri výbere rodičov sa uprednostňujú jedinci z lepšej skupiny.
Najlepšia skupina sa nazýva Pareto front, ide o množinu takých jedinov, nad ktorými nedominuje žiaden iný jedinec.
Na obrázku \ref{fig:pareto_front} je znázornený Pareto front pre dva ciele, spokojnosť a náklady.
Multi-objektívne genetické algoritmy dokážu pracovať aj s viac ako dvoma cieľmi.
Pre optimalizáciu časového rozpisu však stačia dva, jeden zo strany zákazníka (spokojnosť) a druhý zo strany dopravného podniku (náklady).
Tieto základné informácie o fungovaní multi-objektívnych genetických algoritmov s použitím Pareto frontu sú prevzaté z článku \cite{1599245}.

\begin{figure}[h]
    \label{fig:pareto_front}
    \centering
    \begin{tikzpicture}
        \begin{axis}[
            xlabel={Náklady (nižšie je lepšie)},
            ylabel={Spokojnosť (vyššie je lepšie)},
            title={Príklad Pareto frontu},
            grid=major,
            legend pos=south east,
            width=12cm,
            height=6cm,
            scatter/classes={
                dominated={mark=o,draw=blue},
                pareto={mark=*,draw=red,fill=red}
            }
        ]
        \addplot[
            scatter,
            only marks,
            scatter src=explicit symbolic
        ]
        table[meta=label] {
            x y label
            420.0 0.72 pareto
            430.0 0.76 pareto
            440.0 0.80 pareto
            450.0 0.83 pareto
            460.0 0.86 pareto
            470.0 0.88 pareto
            480.0 0.9 pareto
            490.0 0.92 pareto
            500.0 0.93 pareto
            510.0 0.94 pareto
            520.0 0.945 pareto
            530.0 0.95 pareto
            540.0 0.952 pareto
            550.0 0.954 pareto
            560.0 0.956 pareto
            570.0 0.958 pareto
            580.0 0.96 pareto

            460.0 0.70 dominated
            470.0 0.72 dominated
            460.0 0.8 dominated
            475.0 0.75 dominated
            480.0 0.78 dominated
            482.0 0.80 dominated
            485.0 0.82 dominated
            488.0 0.80 dominated
            500.0 0.90 dominated
            500.0 0.85 dominated
            510.0 0.72 dominated
            518.0 0.75 dominated
            519.0 0.80 dominated
            521.0 0.90 dominated
            545.0 0.80 dominated
            547.0 0.75 dominated
            550.0 0.70 dominated
            551.0 0.78 dominated
            551.0 0.85 dominated
            553.0 0.91 dominated
            560.0 0.82 dominated
            580.0 0.75 dominated
        };
        \legend{Dominované, Pareto Front}
        \end{axis}
    \end{tikzpicture}
    \caption{Príklad Pareto frontu}
\end{figure}

\section{Implementácia multi-objektívneho genetického algoritmu}

Pre účely multi-objektívnej optimalizácie bol použitý algoritmus NSGA-II (Non-dominated Sorting Genetic Algorithm II).
V článku \cite{996017} je porovnanie tohto algoritmu s inými multi-objektívnymi genetickými algoritmami.
NSGA-II vo viacerých testoch preukázal, že má lepšie rozloženie a diverzitu jedincov v Pareto fronte ako iné algoritmy.
Práve pre túto vlastnosť bol zvolený aj pre túto prácu.
Okrem testov je v článku \cite{996017} aj podrobný popis fungovania algoritmu.
Algoritmy \ref{algoritmus_nsga2}, \ref{algoritmus_non_dominated_sorting}, \ref{algoritmus_crowding_distance_assignment} a \ref{algoritmus_comparsion_operator} boli z tohto článku prevzaté a mierne upravené pre účely tejto práce.

NSGA-II je založený na triedení jedincov do frontov na základe ich dominancie nad inými jedincami.
Pri výbere jedincov pri krížení sa uprednostňujú jedinci z lepších frontov.
V prípade, že treba porovnať dvoch jedincov z rovnakého frontu, použije sa zhluková vzdialenosť.
Zhluková vzdialenosť zaisťuje vysokú diverzitu jedincov, pretože sa uprednostňujú jedinci, ktorí sú od seba najďalej, teda majú veľké rozdiely v hodnotách cieľov.

Oproti klasickému genetickému algoritmu NSGA-II spracováva elitizmus inak.
V NSGA-II neexistuje konštanta, ktorá by udávala počet elitných jedincov, ktorí sa prenesú do ďalšej generácie.
Pri vytváraní novej generácie sa najprv vytvorí nová populácia z rodičov a ich potomkov.
Táto, dvojnásobne veľká populácia sa následne rozdelí do frontov a pre každého jedinca sa vypočíta zhluková vzdialenosť na základe jeho vzdialenosti od svojich susedov vo fronte.
Potom sa najepšie fronty prenesú do novej generácie.
Posledný prenášaný front sa pravdepodobne nezmestí celý, vtedy sa vyberie toľko jedincov z daného frontu aby bola populácia rovnako veľká naprieč všetkými generáciami.
Jedinci z posledného frontu sa vyberajú na základe zhlukovej vzdialenosti, aby sa zachovala vyššia diverzita.

\subsection*{Inicializácia prvej generácie}
Populácia prvej genrácie sa musí spracovať trochu inak ako ostatné generácie.
Hlavný cyklus algoritmu NSGA-II sa začína spojením rodičov a potomkov do jedného celku.
Na začiatku však žiadnych potomkov nemáme.
Algoritmus \ref{algoritmus_initialization_generation} popisuje ako sa vytvorí populácia prvej generácie a jej potomkovia.
Najprv sa vytvorí prvá generácia jedincov, tým sa náhodne vygenerujú chromozómy.
Následne sa týto jedinci roztriedia na fronty pomocou rýchleho nedominantného triedenia.
V rámci každého frontu sa vypočíta zhluková vzdialenosť každého jedinca.
Na základe získaných ohodnotení sa vyberú tí lepší rodičia a za pomoci kríženia a mutácie sa vytvorí prvá generácia potomkov.

\vspace*{\dimexpr 0.5\baselineskip\relax}
\begin{algorithm}[h]
\caption{Inicializácia prvej generácie}
\label{algoritmus_initialization_generation}
\KwIn{Veľkosť populácie $N$}
  $t \gets 0$ (počiatočná generácia)\;
  $P_t \gets \emptyset$ (inicializácia populácie)\;
  \For{$i = 0$ do $N - 1$} {
    $p_i \gets \text{vytvorenie\_jedinca}()$\;
    $P_t \gets P_t \cup \{p_i\}$\;
  }
  $F \gets \text{rýchle\_nedominantné\_triedenie}(R_t)$\;
  \For{každý front $f \in F$} {
    $\text{priradenie\_zhlukovej\_vzdialenosti}(f)$\;
  }
  $Q_t \gets \text{vytvorenie\_nových\_potomkov}(P_{t+1})$ (kríženie a mutácia)\;
\end{algorithm}

\subsection*{Hlavná slučka algoritmu NSGA-II}
Po inicializácii prvej generácie sa ostatné môžu spracovávať rovnako.
Ako je vidieť v algoritme \ref{algoritmus_nsga2}, hlavná slučka začína spojením rodičov a potomkov do jednej populácie.
Novo vzniknutá populácia sa následne rozdelí do frontov na základe ich dominancie.
Následuje kombinovaný cyklus na spracovanie jednotlivých frontov, ktorý ma dve úlohy:
\begin{enumerate}
  \item Priradenie zhlukovej vzdialenosti jedincov v aktuálnom fronte
  \item Priradenie jedincov aktuálneho frontu do novej generácie
\end{enumerate}
Tento cyklus sa vykonáva pokým sa celý následujúci front zmestí do novej generácie.
Posledný front, ten ktorý sa už nezmestí celý, sa musí spracovať osobitne.
Prvky z tohot frontu sa usporiadajú na základe zhlukovej vzdialenosti a do novej generácie sa prenesú len tie jedince, ktoré sa tam zmestia.
Z novovzniknutej populácie sa následne vytvorí nová generácia potomkov.
Vo všeobecnosti sa táto slučka vykonáva pokiaľ nie je dosiahnutý maximálny počet generácií alebo pokiaľ nebol nájdený optimálny jedinec.
V prípade tejto práce sa však bere do úvahy iba maximálny počet generácií.

\vspace*{\dimexpr 0.5\baselineskip\relax}
\begin{algorithm}[h]
\caption{Hlavná slučka algoritmu NSGA-II}
\label{algoritmus_nsga2}
  $R_t \gets P_t \cup Q_t$ (zlučovanie rodičov a potomkov)\;
  $F \gets \text{rýchle\_nedominantné\_triedenie}(R_t)$\;
  $P_{t+1} \gets \emptyset$ (inicializácia novej populácie)\;
  $i \gets 0$\;
  \While{$|P_{t+1}| + |F_i| \leq N$} {
    $\text{priradenie\_zhlukovej\_vzdialenosti}(F_i)$\;
    $P_{t+1} \gets P_{t+1} \cup F_i$\;
    $i \gets i + 1$\;
  }
  $sort(F_i, \prec_n)$\;
  $P_{t+1} \gets P_{t+1} \cup F_i[0:N - |P_{t+1}|]$\;
  $Q_{t+1} \gets \text{vytvorenie\_nových\_potomkov}(P_{t+1})$ (kríženie a mutácia)\;
  $t \gets t + 1$\;
\end{algorithm}

\subsection*{Rýchle nedominantné triedenie}
Rýchle nedominantné triedenie je základom NSGA-II.
Triedi jedincov do frontov na základe ich dominancie nad inými jedincami.
Jedince dominuje iného jedinca iba v prípade, ak je vo všetkých cieľoch aspoň rovnako dobrý a v aspoň jednom je lepší.
Jedince, ktoré sa navzájom nedominujú, patria do rovnakej skupiny, frontu, preto sa toto triedenie nazýva nedominantné.
Triedenie sa vykonáva v dvoch krokoch:
\begin{itemize}
  \item Výpočet $S_p$ a $n_p$ pre každého jedinca a pridanie jedincov bez dominancie do prvého frontu
  \item Vytvorenie zvyšných frontov za základe získaných hodnôt $S_p$ a $n_p$ z predchádzajúceho kroku
\end{itemize}
V prvom kroku sa musia porovnať všetci jedinci navzájom.
Pre každého jedinca $p$ v prvom cykle algoritmu \ref{algoritmus_non_dominated_sorting} sa vypočíta množina $S_p$, ktorá obsahuje všetkých jedincov, ktorých dominuje $p$ a počet $n_p$, ktorý udáva počet jedincov, ktorí dominujú $p$.
Pokiaľ je $n_p = 0$, jedinec $p$ je nie je nikým dominovaný a pripojí sa do prvého frontu.
Taktiež sa mu priradí hodnota $p_{rank} = 1$.
Rank je hodnota, ktorá udáva v akom fronte sa jedinec nachádza, čím nižšia hodnota, tým je jedinec lepší.

Následuje druhý hlavný cyklus algoritmu \ref{algoritmus_non_dominated_sorting}, ktorý vytvorí zvyšné fronty.
Princíp je taký, že pre každého jedinca $p$ v posledne vytvorenom fronte sa upravia hodnoty $n_q$ všetkých jedincov $q$ z množiny $S_p$.
To vpodstate znamená odstránenie jedinca $p$ z riešeného problému.
Na konci tohto cyklu by sa mal z problému odstrániť celý front $F_i$.
TO znamená, že niektorí jedinci by sa mali stať tými najlepšími v tomto obmedzenom probléme.
Práve títo jedinci sa pridajú do ďalšieho frontu $F_{i+1}$.
Tento cyklus sa opakuje až pokým sa do najnovšieho frontu nemá kto pridať.

Toto triedenie teda iteratívne nachádza najlepší front a odstraňuje ho z problému až pokým sa nenájdu všetky fronty.

\vspace*{\dimexpr 0.5\baselineskip\relax}
\begin{algorithm}[h]
\caption{Rýchle nedominantné triedenie}
\label{algoritmus_non_dominated_sorting}
\KwIn{Populácia $P$}
\KwOut{Fronty nedominovaných jedincov $F$}
  $F \gets \emptyset$ (množina frontov)\;
  \For{každý jedinec $p \in P$} {
    $S_p \gets \emptyset$ (množina jedincov, ktorých dominuje $p$)\;
    $n_p \gets 0$ (počet jedincov, ktorí dominujú $p$)\;
    \For{každý jedinec $q \in P: q \neq p$} {
      \If{$p$ dominuje $q$} {
        $S_p \gets S_p \cup \{q\}$\;
      }
      \ElseIf{$q$ dominuje $p$} {
        $n_p \gets n_p + 1$\;
      }
    }
    \If{$n_p = 0$} {
      $p_{rank} \gets 1$\;
      $F_1 \gets F_1 \cup \{p\}$ (pridanie jedinca $p$ do prvého frontu)\;
    }
  }
  $i \gets 1$\;
  \While{$F_i \neq \emptyset$} {
    $Q \gets \emptyset$ (množina jedincov ďalšieho frontu)\;
    \For{každý jedinec $p \in F_i$} {
      \For{každý jedinec $q \in S_p$} {
        $n_q \gets n_q - 1$\;
        \If{$n_q = 0$} {
          $q_{rank} \gets i + 1$\;
          $Q \gets Q \cup \{q\}$\;
        }
      }
    }
    $i \gets i + 1$\;
    $F_i \gets Q$\;
  }
  \Return $F$\;
\end{algorithm}

\subsection*{Priradenie zhlukovej vzdialenosti}
V rámci jednoho frontu sa jedinci porovnávajú na základe zhlukovej vzdialenosti.
Zhluková vzdialenosť je definovaná ako vzdialenosť jedinca od jeho susedov vo fronte.
Vypočítava sa pre každý cieľ zvlášť a následne sa spočíta.
Najdôležitejšou časťou algoritmu \ref{algoritmus_crowding_distance_assignment} je cyklus, ktorý sa vykonáva pre každý cieľ $c$.
Najprv sa jedinci zoradia podľa dosiahnutých hodnôt cieľa $c$.
Následne sa vytýčia krajné body, jedincom s najmenšou a najväčšou hodnotou cieľa $c$ sa priradí nekonečná zhluková vzdialenosť, pretože sú najviac diverzní.
Pre všetkých ostatných jedincov vo fronte a pre cieľ $c$ sa vypočíta zhluková vzdialenosť ako podiel rozdielu hodnôt susedov a rozdielu krajných jedincov.
Tieto dielčie vzdialenosti sa postupne sčítavajú do celkovej zhlukovej vzdialenosti jedinca.

\vspace*{\dimexpr 0.5\baselineskip\relax}
\begin{algorithm}[h]
\caption{Priradenie zhlukovej vzdialenosti}
\label{algoritmus_crowding_distance_assignment}
\KwIn{Front $L$}
  $l \gets |L|$ (počet jedincov frontu)\;
  \For{každý jedinec $p \in L$} {
    $p_{vzdialenost} \gets 0$ (inicializácia zhlukovej vzdialenosti)\;
  }
  \For{každý cieľ $c$} {
    $L \gets sort(L, c)$ (zoradenie jedincov podľa hodnôt cieľa $c$)\;
    $L[0] \gets \infty$ (priradenie nekonečnej vzdialenosti najmenšiemu jedincovi)\;
    $L[l-1] \gets \infty$ (priradenie nekonečnej vzdialenosti najväčšiemu jedincovi)\;
    \For{$i = 1$ do $l - 2$} {
      $L[i]_{vzdialenost} \gets L[i]_{vzdialenost} + \frac{L[i+1].c - L[i-1].c}{L[l-1].c - L[0].c}$\;
    }
  }
\end{algorithm}

\subsection*{Porovnávací operátor $\prec_n$}
Informácie získané z rýchleho nedominantného triedenia \ref{algoritmus_non_dominated_sorting} a priradenia zhlukovej vzdialenosti \ref{algoritmus_crowding_distance_assignment} sa použijú na porovnanie dvoch jedincov.
Pokiaľ je jedinec $p$ z lep3ieho frontu ako jedinec $q$, teda má lepší, nižší rank, $p$ dominuje $q$.
Ak sú jedinci z rovnakého frontu, porovnávajú sa na základe zhlukovej vzdialenosti.
Dominuje ten, ktorý má väčšiu zhlukovú vzdialenosť, to znamená, že sa výraznejšie odlišuje od svojich susedov vo fronte.
Tento porovnávací operátor je znázornený v algoritme \ref{algoritmus_comparsion_operator}.

\vspace*{\dimexpr 0.5\baselineskip\relax}
\begin{algorithm}[h]
\caption{Porovnávací operátor $\prec_n$}
\label{algoritmus_comparsion_operator}
\KwIn{Jedinci $p$ a $q$}
\KwOut{True ak $p$ dominuje $q$, inak False}
  \Return $p_{rank} < q_{rank} \vee (p_{rank} = q_{rank} \wedge p_{vzdialenost} > q_{vzdialenost})$\;
  (dá sa rozšíriť aj o obmedzenia)\;
\end{algorithm}

Toto porovnávanie sa dá rozšíriť aj o rôzne obmedzenia.
Napríklad, v rámci optimalizácie časového rozpisu máme dva cieľe, spokojnosť zákazníkov a celkové náklady, ale porovnávanie sme rozšírili o to, v ktorom rozpise dôjde menej často k úplnému preplneniu vozidla.
Sledujeme počet prípdov, kedy sa nejaký cestujúci nezmestil do vozidla.
V prípade, že aspoň jeden z porovnávaných jedincov má tento počet iný ako 0, vyhráva ten, ktorý má tento počet menší.
Všeobecne môže byť obmedzení aj viac, v takom prípade sa porovnáva počet porušenia daných obmedzení.
Napríklad ak by sme mali tri rôzne obmedzenia, časový rozpis môže porušovať 0, 1, 2 alebo 3 z nich.
Vyhráva ten rozpis ktorý ich porušuje menej.
V prípade ak oba rozpisy porušujú rovnaký počet obmedzení, porovnáme ich podľa operátora $\prec_n$.
Pre potreby tejto práce máme len jedno spomínané obmedzenie, bližšie informácie k implementácii viacerých obmedzení sú v článku \cite{996017}.

\subsection*{Vytvorenie nových potomkov}
Genetický algoritmus by sa nezaobišiel bez vytvárania nových potomkov.
Tento proces sa dá rozdeliť na tri hlavné časti:
\begin{enumerate}
  \item Výber rodičov
  \item Kríženie rodičov
  \item Mutácia potomkov
\end{enumerate}
Z každého kríženia vzniknú dvaja noví potomkovia, to znamená, že tento proces asa musí vykonať $N/2$ krát, pokiaľ je veľkosť populácie $N$.
Druhá možnosť ako ukončiť tento proces je znázornená v algoritme \ref{algoritmus_vytvorenie_novych_potomkov}, kde sa noví potomkovia prídávajú do množiny $Q$ pokiaľ je ich počet menší ako $N$.

\vspace*{\dimexpr 0.5\baselineskip\relax}
\begin{algorithm}[h]
\caption{Vytvorenie nových potomkov}
\label{algoritmus_vytvorenie_novych_potomkov}
\KwIn{Populácia $P$}
\KwOut{Noví potomkovia $Q$}
  $Q \gets \emptyset$ (inicializácia nových potomkov)\;
  \While{$|Q| < N$} {
    $p_1 \gets \text{výber\_rodiča}(P)$\;
    $p_2 \gets \text{výber\_rodiča}(P)$\;
    $q_1, q_2 \gets \text{kríženie\_rodičov}(p_1, p_2)$\;
    $\text{mutácia\_jedinca}(q_1,)$\;
    $\text{mutácia\_jedinca}(q_2)$\;
    $Q \gets Q \cup \{q_1, q_2\}$\;
  }
  \Return $Q$\;
\end{algorithm}

\subsection*{Výber rodiča}
Pred tým ako sa budú rodičia medzi sebou krížiť, je potrebné ich vybrať.
Pre túto prácu bol zvolený turnajový výber rodiča.
Turnajový výber funguje tak, že sa náhodne vyberie $k$ jedincov z populácie, z ktorých sa turnajovým spôsobom vyberie ten najlepší.
V algoritme \ref{algoritmus_vyber_rodica} je zvolený turnajový výber s $k = 2$, \textit{binary tournament}, teda sa vyberú dvaja náhodní jedinci a porovnajú sa pomocou porovnávacieho operátora $\prec_n$.

Turnajový výber bol pre túto prácu zvolený, pretože je jednoduchý na implementáciu a má dobré výsledky v porovnaní s inými typmi výberu rodičov.
V článku \cite{8477847} je porovnanie roznych typov výberu rodičov.
Turnajový výber má veľmi podobné výsledky ako náhodný výber rodiča, pravdepodobne z dôvodu malého počtu jedincov v turnaji.
Vyšší počet by však mohol celú optimalizáciu spomaliť.
Pokusmi sme odhadli počet jedincov v turnaji na 2.

\vspace*{\dimexpr 0.5\baselineskip\relax}
\begin{algorithm}[h]
\caption{Výber rodiča}
\label{algoritmus_vyber_rodica}
\KwIn{Populácia $P$}
\KwOut{Rodič $p$}
  $p_1 \gets \text{náhodný jedinec z } P$\;
  $p_2 \gets \text{náhodný jedinec z } P$\;
  \If{$p_1 \prec_n p_2$} {
    \Return $p_1$\;
  }
  \Else {
    \Return $p_2$\;
  }
\end{algorithm}

\subsection*{Kríženie rodičov}
Kríženie znamená výmenu génov v chromozómoch rodičov.
Tým vznikajú noví jedinci, potomkovia.
V algoritme \ref{algoritmus_krizenie_rodicov} je znázrnené kríženie dvoch rodičov.
Pre každý gén v chromozómoch rodičov sa náhodne vyberie jeden z rodičov a jeho gén sa priradí prvému potomkovi.
Gén z druhého rodiča sa priradí druhému potomkovi.
Tento proces sa opakuje pre všetky gény v chromozómoch rodičov.
Je vidieť, že takýmto krížením vzniknú dvaja noví jedinci, preto stačí toto kríženie vykonať len $N/2$ krát, pokiaľ je veľkosť populácie $N$.

Tento typ kríženia je známy ako \textit{uniform crossover} a je veľmi populárny v genetických algoritmoch.
Porovnanie rôznych typov kríženia je v článku \cite{7414781}.
Na základe výsledkov v tomto článku bol zvolený typ kríženia s najväčšou diverzitou výsledkov aby sa zamedzilo predčasnej konvergencii, teda aby sa algoritmus nezastavil na lokálnom minime.

\vspace*{\dimexpr 0.5\baselineskip\relax}
\begin{algorithm}[h]
\caption{Kríženie rodičov}
\label{algoritmus_krizenie_rodicov}
\KwIn{Rodičia $p_1$ a $p_2$}
\KwOut{Potomkovia $q_1$ a $q_2$}
  \For{každý gén $g$ v $p_1$} {
    \If{$\text{random}(0,1) < 0,5$} {
      $q_1[g] \gets p_1[g]$\;
      $q_2[g] \gets p_2[g]$\;
    }
    \Else {
      $q_1[g] \gets p_2[g]$\;
      $q_2[g] \gets p_1[g]$\;
    }
  }
  \Return $q_1, q_2$\;
\end{algorithm}

\subsection*{Mutácia jedinca}
Posledným krokom v procese vytvorenia nových potomkov je mutácia.
Mutácia zvyšuje diverzitu jedincov a zabraňuje predčasnému uviaznutiu v lokálnych extrémoch.
V algoritme \ref{algoritmus_mutacia_jedinca} je znázornená mutácia jedinca.
Pre každý gén v chromozóme sa náhodne vyberie číslo z intervalu $[0,1]$.
Ak je toto číslo menšie ako pravdepodobnosť mutácie, gén sa nahradí náhodným génom.

\vspace*{\dimexpr 0.5\baselineskip\relax}
\begin{algorithm}[h]
\caption{Mutácia jedinca}
\label{algoritmus_mutacia_jedinca}
\KwIn{Jedinec $p$}
  \For{každý gén $g$ v $p$} {
    \If{$\text{random}(0,1) < \text{pravdepodobnosť mutácie}$} {
      $p[g] \gets \text{náhodný gén}$\;
    }
  }
\end{algorithm}

\section{Výstupy optimalizácie}
\label{vystupy_optimalizacie}

Výstupom klasického genetického algoritmu by mal byť jedinec s najlepším ohodnotením.
V prípade NSGA-II je to front s najlepšími jedincami.
Keďže všetky jedince v najlepšom fronte sú rovnako dobré, nedá sa jednoznačne určiť, ktorý z nich je najlepší.
Ich ohodnotenie je závislé od viacerých cieľov, v prípade tejto práce dvoch.
Po skončení optimalizácie sa celá posledná generácia približuje optimálnemu frontu riešení.
To znamená, že všetky časové rozpisy v poslednej generácii sú rovnako dobrým výsledkom.
Pre výber toho najlepšieho jedinca je potrebné rozhodnúť sa, ktorý z cieľov je dôležitejší, prípade ich váhy.
Táto práca sa už musí nechať na používateľa programu, ktorý sa sám rozhodne, ktorý z rozpisov je pre neho najlepší.
Z výsledkov priebežných experimentov počas vývoja programu sa ukázalo, že rozpisy s vyššou spokojnosťou cestujúcich majú z pravidla aj vyššie celkové náklady.
Ako postupne klesajú náklady, klesá aj spokojnosť cestujúcich, pretože sa znižuje počet spojov, to má za následok preplnenejšie vozidlá a dlhšie čakacie doby na zastávkach.
Tieto experimenty sú bližšie popísané v kapitole \ref{experimenty}.

\begin{figure}[h]
  \label{fig:population_start_end}
  \centering
  \begin{tikzpicture}
    \begin{axis}[
      xlabel={Náklady (nižšie je lepšie)},
      ylabel={Spokojnosť (vyššie je lepšie)},
      title={Populácia na začiatku a na konci optimalizácie},
      grid=major,
      legend pos=south east,
      width=12cm,
      height=6cm,
      scatter/classes={
          dominated={mark=o,draw=blue},
          pareto={mark=*,draw=red,fill=red}
      }
    ]
    \addplot[
      scatter,
      only marks,
      scatter src=explicit symbolic
    ]
    table[meta=label] {
      x y label
      34593.6192 0.698766814270199 dominated
      36110.8832 0.7560682593856592 dominated
      36414.335999999996 0.7300462923996281 dominated
      36414.335999999996 0.7953992297817675 dominated
      36717.788799999995 0.8145726857336179 dominated
      36717.788799999995 0.7974700146690784 dominated
      37324.6944 0.8628327143967477 dominated
      37931.6 0.7640401922236763 dominated
      38235.0528 0.8043758906865585 dominated
      38841.958399999996 0.8290733914209067 dominated
      39448.863999999994 0.7745494084899076 dominated
      40055.76959999999 0.8056625705745529 dominated
      40359.2224 0.6947178444331448 dominated
      40359.2224 0.8067975544648183 dominated
      40662.6752 0.8170223752151435 dominated
      40662.6752 0.7526894033690112 dominated
      40966.128 0.7957035301990926 dominated
      40966.128 0.843842264914051 dominated
      41269.580799999996 0.8197795038837332 dominated
      41269.580799999996 0.8680407209612772 dominated
      41573.0336 0.8326062494590158 dominated
      41876.486399999994 0.8371112229491665 dominated
      42179.93919999999 0.8825829363360709 dominated
      42179.93919999999 0.8730773109243625 dominated
      42786.8448 0.847443283201624 dominated
      42786.8448 0.8828430873621682 dominated
      42786.8448 0.8204861227922611 dominated
      42786.8448 0.8362688591286608 dominated
      43090.2976 0.9021138073898618 dominated
      44000.655999999995 0.8631854265897849 dominated
      44000.655999999995 0.8628972991279271 dominated
      44000.655999999995 0.8292353951889984 dominated
      44304.108799999995 0.9155924905270366 dominated
      44911.0144 0.7854295932795443 dominated
      45214.46719999999 0.8869831832852022 dominated
      46124.8256 0.8566406120073122 dominated
      46731.73119999999 0.8836561866125701 dominated
      47035.183999999994 0.8797202797202752 dominated
      47338.6368 0.847873684210521 dominated
      47642.08959999999 0.8340823970037414 dominated
      47945.5424 0.8399150495544213 dominated
      48552.448 0.8317564802182806 dominated
      49462.806399999994 0.8621990315578529 dominated
      49766.25919999999 0.9197099019032373 dominated
      50980.0704 0.8158174027686208 dominated
      50980.0704 0.8874712835025756 dominated
      52800.78719999999 0.9282750998894747 dominated
      55228.40959999999 0.9591714575583303 dominated
      55835.31519999998 0.9631262798634764 dominated
      57049.126399999994 0.947870934959343 dominated
      17600.2624 0.6562155059132695 pareto
      18207.167999999998 0.6589360197949811 pareto
      18510.620799999997 0.6636070458329676 pareto
      20027.884799999996 0.7367264857065519 pareto
      20331.3376 0.7401511514181519 pareto
      20634.790399999998 0.7444830408293153 pareto
      20938.243199999997 0.751307508199624 pareto
      21241.696 0.7562538892345931 pareto
      21545.1488 0.7627662565905033 pareto
      21848.601599999995 0.7644937216136719 pareto
      22455.5072 0.767252314021248 pareto
      23365.865599999994 0.8209870865027319 pareto
      23669.3184 0.8237714587551634 pareto
      24276.224 0.8291082858395329 pareto
      24579.676799999997 0.8413978682509076 pareto
      25186.5824 0.8472269938650214 pareto
      25490.0352 0.8567756029360242 pareto
      26400.393599999996 0.8625608061153471 pareto
      26703.846399999995 0.8627581463330646 pareto
      27007.299199999998 0.8733551273227685 pareto
      27310.752 0.8840321882841456 pareto
      27917.65759999999 0.8890859980831128 pareto
      28221.1104 0.8966087719298096 pareto
      28524.563199999997 0.8978779095300723 pareto
      29738.3744 0.9113484622798445 pareto
      30041.827199999996 0.9174568096114935 pareto
      30952.185599999997 0.9195637058925635 pareto
      31255.6384 0.9275939719383215 pareto
      31862.543999999998 0.930055712693909 pareto
      32469.449599999996 0.9323767361110995 pareto
      32772.9024 0.9428970088078726 pareto
      33379.808 0.9432454753118849 pareto
      33683.2608 0.9444301932576343 pareto
      33986.7136 0.9501810934927507 pareto
      34897.072 0.9564164691422928 pareto
      35503.9776 0.9568245614034963 pareto
      35807.4304 0.9584162615996357 pareto
      36110.8832 0.9591693796744257 pareto
      37021.241599999994 0.9619377043538 pareto
      37628.14719999999 0.9676506396118112 pareto
      39448.863999999994 0.9734642765245602 pareto
      40966.128 0.9757380254154341 pareto
      41876.486399999994 0.9802846167277695 pareto
      45821.3728 0.9837892008639219 pareto
      46428.278399999996 0.9847617435463304 pareto
      48248.99519999999 0.9849325852106111 pareto
      48552.448 0.9849570468656866 pareto
      48855.900799999996 0.9855566716892594 pareto
      51283.52319999998 0.990090885925414 pareto
      51586.975999999995 0.9907816482582757 pareto
    };
    \legend{Prvá Generácia, Posledná Generácia}
    \end{axis}
  \end{tikzpicture}
  \caption{Populácia na začiatku a na konci optimalizácie}
\end{figure}

Na obrázku \ref{fig:population_start_end} je vidieť priaznivé výsledky optimalizácie.
Algoritmus NSGA-II sa po 100 generáciach priblížil k optimálnemu frontu riešení.
Oproti prvej generácii sa značne znížili náklady a zvýšila spokojnosť cestujúcich.
Tento výsledok ukazuje, že genetický algoritmus dokáže efektívne nájsť kompromis medzi protichodnými cieľmi, ako sú náklady a spokojnosť.
Použitie NSGA-II umožnilo zachovať diverzitu riešení, čo poskytuje používateľovi možnosť výberu najvhodnejšieho časového rozpisu podľa jeho preferencií.
\chapter{Experimenty} % 10 strán
\label{experimenty}

V tejto kapitole sú podrobne popísané experimentálne scenáre, ktoré boli navrhnuté na posúdenie výkonnosti optimalizačného algoritmu aplikovaného na plánovanie liniek MHD.
Cieľom bolo preskúmať, ako algoritmus reaguje na zmeny v parametroch ako sú dĺžka trasy, dĺžka vozidla a počet zastávok.

Každý experiment bol vykonaný s rovnakými parametrami pre genetický algoritmus, aby sa zabezpečila konzistentnosť výsledkov:
\begin{itemize}
  \item \textbf{Počet jedincov v populácii} --- 50 pre krátku trasu, 10 pre dlhú trasu \footnote{Tento počet bol znížený z dôvodu dlhšej doby výpočtu.}
  \item \textbf{Počet generácií} --- 100
  \item \textbf{Pravdepodobnosť mutácie} --- 5\%
  \item \textbf{Maximálny počet spojov za hodinu} --- 15
\end{itemize}
Ostatné parametre sú špecifické pre jednotlivé experimenty a sú uvedené v tabuľkách v príslušných sekciách.

Parametre zariadenia na ktorom boli experimenty vykonané sú:
\begin{itemize}
  \item \textbf{Operačný systém} --- Windows 11 Pro 64-bit
  \item \textbf{Procesor} --- Intel Core i7-9750H CPU @ 2.60GHz
  \item \textbf{RAM} --- 16 GB DDR4
\end{itemize}

Všetky experimenty boli vykonané na rovnakom zariadení, aby sa zabezpečila konzistentnosť výsledkov,
a v rovnakom čase, aby sa minimalizoval vplyv vonkajších faktorov.
Každý experiment trval približne od 45 minút do 1.5 hodiny v závislosti od dĺžky trasy a počtu zastávok.

\newpage
\section{Experiment s krátkou trasou a krátkym vozidlom}
Cieľom tohto experimentu je zistiť, ako sa algoritmus vyrovnáva s krátkou trasou a krátkym vozidlom.
Ako referencia bola zvolená linka 46 v Brne, ktorej trasa pozostáva z 11 zastávok.
Parametry experimentu sú uvedené v tabuľke \ref{tab:shortDshortVin}.

\begin{table}[h]
  \centering
  \begin{tabular}{|l|c|}
    \hline
    \textbf{Vstup} & \textbf{Hodnota} \\ \hline
    Kapacita vozidla & 80 \\ \hline
    Miest na sedenie & 30 \\ \hline
    Celkové náklady & 92,82 Kč/100 miesto-km \\ \hline
    Dĺžka trasy & 3,8 km \\ \hline
  \end{tabular}
  \caption{Parametre vozidla a trasy}
  \label{tab:shortDshortVin}
\end{table}

Ako je vidieť v tabuľke \ref{tab:shortDshortVout}, optimalizácia prebehla úspešne.
Algoritmus bol schopný vygenerovať rozpis, pri ktorom je spokojnosť cestujúcich 94\% a počet cestujúcich.
Vozidlá sú v priemere zaplnené do jednej tretiny, pretože ich je až 115, to je o 3 spoje menej ako je aktu8lny rozpis linky 46.

\begin{table}[h]
  \centering
  \begin{tabular}{|l|c|}
    \hline
      \textbf{Výstup} & \textbf{Hodnota} \\ \hline
      Počet príchodov cestujúcich & 11603 \\ \hline
      Počet prevezených cestujúcich & 11603 \\ \hline
      Počet neobslúžených cestujúcich & 0 (0,0\,\%) \\ \hline
      Celkový čas strávený čakaním & 54625 min \\ \hline
      Priemerný čas strávený čakaním & 5 min \\ \hline
      Celkové náklady & 32450 Kč \\ \hline
      Priemerná spokojnosť cestujúcich & 94,0\,\% \\ \hline
      Celkový počet vozidiel & 115 \\ \hline
      Priemerná naplnenosť vozidiel & 25 (31,02\,\%) \\ \hline
  \end{tabular}
  \caption{Výstupy simulácie}
  \label{tab:shortDshortVout}
\end{table}

Celý rozpis zastávok, časový rozpis a grafy podrobnejšie popisujúce tento experiment sú uvedené v prílohe \ref{shortDshortV}.

\newpage

\section{Experiment s krátkou trasou a dlhým vozidlom}
Cieľom tohto experimentu je zistiť, ako sa algoritmus vyrovnáva s krátkou trasou a dlhým vozidlom.
Ako referencia bola zvolená linka 46 v Brne, ktorej trasa pozostáva z 11 zastávok.
Parametry experimentu sú uvedené v tabuľke \ref{tab:shortDlongVin}.

\begin{table}[h]
  \centering
  \begin{tabular}{|l|c|}
    \hline
    \textbf{Vstup} & \textbf{Hodnota} \\ \hline
    Kapacita vozidla & 160 \\ \hline
    Počet miest na sedenie & 60 \\ \hline
    Celkové náklady & 92,82 Kč/100 miesto-km \\ \hline
    Dĺžka trasy & 3,8 km \\ \hline
  \end{tabular}
  \caption{Parametre vozidla a trasy}
  \label{tab:shortDlongVin}
\end{table}

V tabuľke \ref{tab:shortDlongVout} sú vidieť zmeny oproti predošlému experimentu.
Navýšenie kapacity jednoho vozidla má vplyv na:
\begin{itemize}
  \item Priemerná čakacia doba sa zvýšila o 2 minúty
  \item Spokojnosť cestiujúcich sa zvýšila o 4,54\%
  \item Počet vozidiel sa znížil o 43 kusov
  \item Priemerná naplnenosť vozidiel sa znížila o 6,42\%
\end{itemize}

\begin{table}[h]
  \centering
  \begin{tabular}{|l|c|}
    \hline
      \textbf{Výstup} & \textbf{Hodnota} \\ \hline
      Počet príchodov cestujúcich & 11528 \\ \hline
      Počet prevezených cestujúcich & 11528 \\ \hline
      Počet neobslúžených cestujúcich & 0 (0,0\,\%) \\ \hline
      Celkový čas strávený čakaním & 86013 min \\ \hline
      Priemerný čas strávený čakaním & 7 min \\ \hline
      Celkové náklady & 40633 Kč \\ \hline
      Priemerná spokojnosť cestujúcich & 98,54\,\% \\ \hline
      Celkový počet vozidiel & 72 \\ \hline
      Priemerná naplnenosť vozidiel & 39 (24,6\,\%) \\ \hline
  \end{tabular}
  \caption{Výstupy simulácie}
  \label{tab:shortDlongVout}
\end{table}

Celý rozpis zastávok, časový rozpis a grafy podrobnejšie popisujúce tento experiment sú uvedené v prílohe \ref{shortDlongV}.

\newpage

\section{Experiment s dlhou trasou a krátkym vozidlom}
Cieľom tohto experimentu je zistiť, ako sa algoritmus vyrovnáva s dlhou trasou a krátkym vozidlom.
Ako referencia bola zvolená okružná linka 84 v Brne, ktorej trasa pozostáva zo 44 zastávok.
Parametry experimentu sú uvedené v tabuľke \ref{tab:longDshortVin}.

\begin{table}[h]
  \centering
  \begin{tabular}{|l|c|}
    \hline
    \textbf{Vstup} & \textbf{Hodnota} \\ \hline
    Kapacita vozidla & 80 \\ \hline
    Počet miest na sedenie & 30 \\ \hline
    Celkové náklady & 92,82 Kč/100 miesto-km \\ \hline
    Dĺžka trasy & 23,0 km \\ \hline
  \end{tabular}
  \caption{Parametre vozidla a trasy}
  \label{tab:longDshortVin}
\end{table}

Z tabuľky \ref{tab:longDshortVout} je vidieť, že algoritmus bol schopný vygenerovať rozpis, pri ktorom je spokojnosť cestujúcich viac ako 98\%.
Priemerná čakacia doba, počet vozidiel a priemerná naplnenosť vozidiel sú veľmi podobné ako v prípade krátkej trasy.
Oproti nej však vzrástol počet cestujúcich a teda aj celkový čas strávený čakaním.
Taktiež sa zvýšili celkové náklady na prevádzku.

\begin{table}[h]
  \centering
  \begin{tabular}{|l|c|}
    \hline
      \textbf{Výstup} & \textbf{Hodnota} \\ \hline
        Počet príchodov cestujúcich & 49041 \\ \hline
        Počet prevezených cestujúcich & 49041 \\ \hline
        Počet neobslúžených cestujúcich & 0 (0,0\,\%) \\ \hline
        Celkový čas strávený čakaním & 253052 min \\ \hline
        Priemerný čas strávený čakaním & 5 min \\ \hline
        Celkové náklady & 189576 Kč \\ \hline
        Priemerná spokojnosť cestujúcich & 98,1\,\% \\ \hline
        Celkový počet vozidiel & 111 \\ \hline
        Priemerná naplnenosť vozidiel & 22 (27,67\,\%) \\ \hline
  \end{tabular}
  \caption{Výstupy simulácie}
  \label{tab:longDshortVout}
\end{table}

Celý rozpis zastávok, časový rozpis a grafy podrobnejšie popisujúce tento experiment sú uvedené v prílohe \ref{longDshortV}.

\newpage
\section{Experiment s dlhou trasou a dlhým vozidlom}
Cieľom tohto experimentu je zistiť, ako sa algoritmus vyrovnáva s dlhou trasou a dlhým vozidlom.
Ako referencia bola zvolená okružná linka 84 v Brne, ktorej trasa pozostáva zo 44 zastávok.
Parametry experimentu sú uvedené v tabuľke \ref{tab:longDlongVin}.

\begin{table}[h]
  \centering
  \begin{tabular}{|l|c|}
    \hline
    \textbf{Vstup} & \textbf{Hodnota} \\ \hline
    Kapacita vozidla & 160 \\ \hline
    Počet miest na sedenie & 60 \\ \hline
    Celkové náklady & 92,82 Kč/100 miesto-km \\ \hline
    Dĺžka trasy & 23,0 km \\ \hline
  \end{tabular}
  \caption{Parametre vozidla a trasy}
  \label{tab:longDlongVin}
\end{table}

Výstupy experimentu je možné vidieť v tabuľke \ref{tab:longDlongVout}.
Oproti experimentu s dlhou cestou ale krátkym vozidlom sa zmenili následovné parametre:
\begin{itemize}
  \item Priemerná čakacia doba sa zvýšila o 2 minúty
  \item Spokojnosť cestiujúcich sa zvýšila o 1,88\%
  \item Počet vozidiel sa znížil o 29 kusov
  \item Priemerná naplnenosť vozidiel sa znížila o 9,04\%
\end{itemize}

\begin{table}[h]
  \centering
  \begin{tabular}{|l|c|}
    \hline
      \textbf{Výstup} & \textbf{Hodnota} \\ \hline
        Počet príchodov cestujúcich & 48358 \\ \hline
          Počet prevezených cestujúcich & 48358 \\ \hline
          Počet neobslúžených cestujúcich & 0 (0,0\,\%) \\ \hline
          Celkový čas strávený čakaním & 314379 min \\ \hline
          Priemerný čas strávený čakaním & 7 min \\ \hline
          Celkové náklady & 280094 Kč \\ \hline
          Priemerná spokojnosť cestujúcich & 99,98\,\% \\ \hline
          Celkový počet vozidiel & 82 \\ \hline
          Priemerná naplnenosť vozidiel & 30 (18,63\,\%) \\ \hline
  \end{tabular}
  \caption{Výstupy simulácie}
  \label{tab:longDlongVout}
\end{table}

Celý rozpis zastávok, časový rozpis a grafy podrobnejšie popisujúce tento experiment sú uvedené v prílohe \ref{longDlongV}.

\chapter{Nástroj na analýzu a optimalizáciu časových rozpisov}
\label{nastroj}

Poslednoučasťou tejto práce je implementácia nástroja na analýzu a optimalizáciu časových rozpisov.
Tento nástroj bude slúžiť ako rozhranie medzi požívateľom a optimalizačným algoritmom.
Nástroj bude mať dve hlavné funkcie:
\begin{itemize}
  \item \textbf{Analýza časového rozpisu} --- nástroj prevezme existujúci časový rozpis a vykoná analýzu jeho kvality. Na to poslúži spustenie simulácie, zber štatistík a ich vizualizácia.
  \item \textbf{Optimalizácia časového rozpisu} --- nástroj vygeneruje nové časové rozpisy na základe vstupných parametrov a požiadaviek používateľa. Na to poslúži optimalizačný algoritmus NSGA-II.
\end{itemize}

Uživateľské rozhranie by malo byť intuitívne a jednoduché.
Hlavným cieľom tejto práce je optimalizácia, preto je kladený väčší dôraz na ňu ako na samotné užívateľské rozhranie.
Toto rozhranie, bez ohľadu na to ako moc jednoduché bude, je dôležité, preto tento krok nesmie byť zanedbaný.

\section{Návrh uživateľského rozhrania}
\label{nastroj_uzivatelske_rozhranie}

Prvým krokom pri tovrbe u živateľských rozhraní je návrh.
Najprv si treba premyslieť, čo všetko bude nástroj robiť a aké funkcie bude mať.
Tento nástroj by mal vedieť analyzovať nahrané časové rozpisy, vizualizovať zistenia zo simulácie, prezentovať ich formou grafov a štatistík.
Ďalej by mal vedieť optimalizovať časové rozpisy. Výpočet optimalizácie pomocou genetického algoritmu je časovo náročný úkon a preto by bolo vhodné používateľa informovať o priebehu optimalizácie.
Po dokončení optimalizácie by mal mať používateľ možnosť vybrať si rozpis, ktorý sa mu páči najviac a uložiť si ho.
Malo by byť možné analyzovať aj uložené rozpisy.
Prípadne by nástroj mohol ponúkať exportovanie analýzy rozpisu.

Všetky tieto funkcie sa dajú rozdeliť medzi dve stránky, stránku pre analýzu a stránku pre optimalizáciu.
Na prepínanie medzi stránkami poslúži jednoduché menu v hornej časti okna.
Na ich návrh boli použité wireframy.

\newpage
\subsection*{Stránka pre analýzu časového rozpisu}
Na stránke analýzy časového rozpisu bude možné:
\begin{itemize}
  \item nahrať informáie o zastávkach
  \item nahrať informácie o časovom rozpise
  \item nahrať uložený časový rozpis
  \item zadať parametre pre simuláciu
  \item Resetovať stránku
  \item spustiť simuláciu
  \item zobraziť výsledky simulácie, vrátane grafov a štatistík
  \item uložiť výsledky analýzy
\end{itemize}

\begin{figure}[h]
  \centering
  \includegraphics[width=\textwidth]{wireframe_analyze.pdf}
  \caption{Wireframe pre analýzu časového rozpisu}
  \label{fig:wireframe_analyze}
\end{figure}

Na obrázku \ref{fig:wireframe_analyze} je znázornený wireframe pre túto stránku.
Funkcie spomenuté vyššie sú usporiadané rovnako ako jednotlivé elementy stránky.
Pre nahranie informácií o zastávke a novom časovom rozpise bude slúžiť vyberač súborov.
Informácie by mali byť uložené v textovom súbore.
Uživateľské rozhranie by malo obsahovať nápovedu, ktorá používateľovi ukáže aký formát majú mať vstupné súbory.

\noindent Formát potrebný na spracovanie informácií o zastávkach:

\noindent \texttt{Lesná, Haškova:0:[(5, 60), (6, 90), \ldots , (21, 40), (22, 30)]:0 \newline
  Brechtova:1:[(5, 60), (6, 90), \ldots , (21, 40), (22, 30)]:0.1 \newline
  Blažkova:2:[(5, 60), (6, 90), \ldots , (21, 40), (22, 30)]:0.1 \newline
  \ldots
}

\noindent Formát potrebný na spracovanie informácií o časovom rozpise:

\noindent \texttt{04: \newline
  05:01,11,21,31,41,51 \newline
  06:01,08,14,21,28,34,41,48,54 \newline
  07:01,08,14,21,28,34,41,48,54 \newline
  08:01,08,18,28,38,48,58 \newline
  09:08,18,28,38,48,58 \newline
  \ldots
}

Výber uloženého rozpisu môže byť realizovaný formou rozbaľovacej ponuky (dropdown).
Rozpisy v tejto ponuke by mali byť pomenované, aby bol výber prehľadný.
Vstupné parametre \texttt{Kapacita vozidla}, \texttt{Miest na sedenie}, \texttt{Náklady na 100 miesto-km} a \texttt{Dľžka trasy} budú realizované jednoduchými textovými vstupmi, s obmedzením len na numerické znaky, prípadne číslenými obmedzeniami potrebnými pre dané parametre.
Tlačítko \texttt{Resetovať} vymaže všetky vstupy aj výstupy analýzy.
Tlačítko \texttt{Analyzovať} spustí simuláciu časového rozpisu a zobrazí výsledky analýzy.
Medzi tieto výsledky budú patriť agregované hodnoty:
\begin{itemize}
  \item Počet príchodov cestujúcich
  \item Počet prevezených cestujúcich
  \item Počet neobslúžených cestujúcich
  \item Celkový čas strávený čakaním
  \item Priemerný čas strávený čakaním
  \item Celkové náklady
  \item Priemerná spokojnosť cestujúcich
  \item Celkový počet vozidiel
  \item Priemerná naplnenosť vozidiel
\end{itemize}
Taktiež budú na stránke zobrazené grafy s hodnotami rôznych štatistík za hodinu aby boli vidieť zmeny v priebehu dňa, konkrétne:
\begin{itemize}
  \item Cestujúci prichádzajúci za hodinu
  \item Priemerný čas strávený čakaním za hodinu
  \item Počet prípadov kedy sa cestujúci nezmestili do vozidla za hodinu
\end{itemize}
Posledným grafom bude:
\begin{itemize}
  \item Priemerná naplnenosť vozidiel naprieč zastávkami
\end{itemize}
Po stlačení tlačítka \texttt{Uložiť analýzu} sa otvorí vyberač súborov, aby si používateľ mohol vybrať kam sa analýza uloží.
Analýza sa bude ukladať vo forme textovévo súboru.

\newpage
\subsection*{Stránka pre optimalizáciu časového rozpisu}
Na stránke optimalizácie časového rozpisu bude možné:
\begin{itemize}
  \item nahrať informáie o zastávkach
  \item zadať parametre pre optimalizáciu
  \item Resetovať stránku
  \item spustiť optimalizáciu
  \item zobraziť priebežne dosiahnuté cieľe aktuálne spracovanej generácie
  \item vybrať rozpis z generácie
  \item uložiť vybraný rozpis
\end{itemize}

\begin{figure}[h]
  \centering
  \includegraphics[width=\textwidth]{wireframe_optimize.pdf}
  \caption{Wireframe pre optimalizáciu časového rozpisu}
  \label{fig:wireframe_optimize}
\end{figure}

Na obrázku \ref{fig:wireframe_optimize} je znázornený wireframe pre túto stránku.
Pre nahranie informácií o zastávke bude slúžiť rovnaký vyberač súborov ako na stránke analýzy.
Vyberač pre časový rozpis tu nie je potrebný, pretože z hladiska optimalizácie je časový rozpis výstupom a nie vstupom.
Číselné vstupné parametre pre simuláciu sú rovnaké ako na stránke analýzy, ale pre genetický algoritmus tu sú štyri nové a to \texttt{Velkosť populácie}, \texttt{Počet generácií}, \texttt{Pravdepodobnosť mutácie} a \texttt{Maximálny počet spojov za hodinu}.
Tlačítko \texttt{Resetovať} vymaže všetky vstupy aj výstupy optimalizácie.
Tlačítko \texttt{Optimalizovať} spustí optimalizáciu čaového rozpisu.
Používateľ by mal počas optimalizácie byť schopný vidieť:
\begin{itemize}
  \item V koľkatej generácii sa algoritmus nachádza
  \item Koľko generácií bude algoritmus spracovávať
  \item Kedy optimalizácia začala
  \item Kedy optimalizácia skončila (ak už skončila)
  \item Ako dlho optimalizácia trvala (ak už skončila)
  \item Graf s priebežnými dosiahnutými cieľmi jednotlivých jedincov v aktuálne dosiahnutej generácii
\end{itemize}
Po dokončení optimalizácie by mal byť používateľ schopný prezrieť si všetky rozpisy v poslednej generácii.
To bude zabezpečené posuvným tiahlom, a zobrazením aktuálne vybraného rozpisu.
Tiahlo bude mať toľko krokov, koľko je rozpisov v generácii.
Vyplnením textového vstupu pre názov rozpisu a stlačením tlačítka \texttt{Uložiť rozpis} sa rozpis uloží.
Nepomenovaný rozpis sa označí časom a dátumom vytvorenia.

\section{Implementácia nástroja}
\label{nastroj_implementacia}

Po návrhu náslduje implementácia.
Predtým však treba vybrať technológie, ktoré sú na to vhodné a navrhnúť architektúru aplikácie.


\subsection*{Použité technológie}
Ako programovací jazyk bol zvolený \texttt{Python} a to preto, lebo je veľmi verzatilný.
Výhodnejšie by možno bolo naprogramovať optimalizačný algoritmus v jazyku \texttt{C} alebo \texttt{C++}, ktoré sú rýchlejšie.

\texttt{Python} bol však vybraný vďaka jednoduchému použitiu a tomu, že sa v ňom dá pohodlne napísať ako backend, tak aj frontend.
Na to aby sa mohlol v tomto jazyku písať aj frontend bol využitý framework \texttt{Reflex} \footnote{\url{https://reflex.dev/}}.

Vďaka tomtu frameworku je možné písať webové komponenty a celé stránky priamo v jazyku \texttt{Python}.
Každý komponent je písaný formou funkcie, ktorá vracia jeho obsah.
Tým sa dajú komponnty zhlukovať do väčších komponentov alebo stránok.
Vstupy komponentov sa dajú predávať ako parametre jeho funkcie, alebo môže komponent pracovať s premennými, ktoré sú súčasťou triedy \texttt{State}.
\texttt{State} je trieda, ktorá počas behu aplikácie uchováva jej stav.
K premenným tohto stavu sa dá jednoducho pristupovať, čítať ich hodnoty aj prepisovať ich.
Takýchto tried môže byť v aplikácii viacej a jeden komponent môže pracovať s premennými aj viacerých stavov.
Stav okrem premenných obsahuje aj metódy, ktoré sa volajú pri danej udalosti.
Medzi udalosti patrí napríklad stlačenie konkrétneho tlačítka, alebo zmena hodnoty v jednom z textových vstupov.
V týchto metódach sa môže pristupovať aj k premenným iného stavu.                                                                                                             

Takáto verzatilita jazyka a frameworku bola pri tejto práci veľmi výtaná. 
Treba si však dávať pozor, pretože priveľká sloboda v písaní kódu môže mať za následok neprehľadný, príliš previazaný kód, ktorý sa bude v budúcnosti ťažko rozširovať.
Pretože sa s týmito technológiami dá aplikácia napísať naozaj veľmi veľa spôsobmi, je potrebné zvoliť si dobrú architektúru, rozčlenenie aplikácie na moduly, a tie na jednotlivé webové komponenty alebo backendové skripty.

\subsection*{Architektúra aplikácie}
 

\chapter{Záver} % 1 strana
\label{zaver}
